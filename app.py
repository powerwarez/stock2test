import os
import streamlit as st
import random
import time
import pandas as pd
from datetime import date
import plotly.express as px
from openai import OpenAI
import json
from supabase import create_client, Client

# --- Streamlit ì„¤ì • ---
st.set_page_config(
    page_title="ìˆ˜ì¤€ë³„ ëª¨ì˜ ì£¼ì‹ ê±°ë˜",
    page_icon="ğŸ’°",
    layout="wide",
    initial_sidebar_state="expanded",
)

# --- Custom CSS (ìŠ¤íƒ€ì¼ë§) ---
# (ê¸°ì¡´ CSS ì½”ë“œëŠ” ë³€ê²½ ì—†ì´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
st.markdown(
    """
<style>
/* ì „ì²´ í°íŠ¸ ë³€ê²½ (Nanum Gothic, Google Fonts CDN ì‚¬ìš©) */
@import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap');
body {
    font-family: 'Nanum Gothic', sans-serif !important;
}

/* íƒ­ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
.stTabs [data-baseweb="tab-list"] button[aria-selected="true"] {
    background-color: #007bff !important;
    color: white !important;
    font-weight: bold;
}
.stTabs [data-baseweb="tab-list"] button {
    background-color: #f0f2f6;
    color: #333;
    border-radius: 8px 8px 0 0;
    padding: 0.75em 1em;
    margin-bottom: -1px; /* border overlap */
}

/* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
[data-testid="stSidebar"] {
    width: 350px !important;
    background-color: #f8f9fa; /* Light gray sidebar background */
    padding: 20px;
}
[data-testid="stSidebar"] h1, [data-testid="stSidebar"] h3 {
    color: #212529; /* Dark gray sidebar headings */
}
[data-testid="stSidebar"] hr {
    border-top: 1px solid #e0e0e0; /* Lighter sidebar hr */
}

/* Metric ìŠ¤íƒ€ì¼ */
.streamlit-metric-label {
    font-size: 16px;
    color: #4a4a4a;
}
.streamlit-metric-value {
    font-size: 28px;
    font-weight: bold;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
div.stButton > button {
    background-color: #007bff;
    color: white;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.1); /* Soft shadow */
    transition: background-color 0.3s ease;
}
div.stButton > button:hover {
    background-color: #0056b3;
    box-shadow: 2px 2px 7px rgba(0,0,0,0.15); /* Slightly stronger shadow on hover */
}

/* ë³´ì¡° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
div.stButton > button.secondary-button {
    background-color: #6c757d;
    color: white;
    padding: 10px 20px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    transition: background-color 0.3s ease;
}
div.stButton > button.secondary-button:hover {
    background-color: #5a6268;
}

/* Expander ìŠ¤íƒ€ì¼ */
.streamlit-expanderHeader {
    font-weight: bold;
    color: #212529;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 8px;
    margin-bottom: 15px;
}

/* Dataframe ìŠ¤íƒ€ì¼ */
.dataframe {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.05); /* Very subtle shadow */
}

/* Info, Success, Error, Warning Box ìŠ¤íƒ€ì¼ (ë” ë¶€ë“œëŸ¬ìš´ ìŠ¤íƒ€ì¼) */
div.stInfo, div.stSuccess, div.stError, div.stWarning {
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
}
div.stInfo {
    background-color: #e7f3ff;
    border-left: 5px solid #007bff;
}
div.stSuccess {
    background-color: #e6f7ec;
    border-left: 5px solid #28a745;
}
div.stError {
    background-color: #fdeded;
    border-left: 5px solid #dc3545;
}
div.stWarning {
    background-color: #fffbe6;
    border-left: 5px solid #ffc107;
}

/* Toast message ìŠ¤íƒ€ì¼ */
div.streamlit-toast-container {
    z-index: 10000; /* Toastë¥¼ í•­ìƒ ë§¨ ìœ„ì— í‘œì‹œ */
}
div[data-testid="stToast"] {
    border-radius: 8px;
    padding: 15px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
}

</style>
""",
    unsafe_allow_html=True,
)

# --- API í‚¤ ì„¤ì • ---
if "OPENAI_API_KEY" not in os.environ:
    st.error("OPENAI_API_KEY í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.")
    st.stop()
client = OpenAI(api_key=os.environ["OPENAI_API_KEY"])

# --- Supabase ì„¤ì • ---
SUPABASE_URL = os.environ.get("SUPABASE_URL")
SUPABASE_KEY = os.environ.get("SUPABASE_KEY")
if not SUPABASE_URL or not SUPABASE_KEY:
    st.warning("Supabase URL ë˜ëŠ” Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë°ì´í„° ì €ì¥/ë¡œë“œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.")
    supabase = None
else:
    try:
        supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)
    except Exception as e:
        st.error(f"Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨: {e}")
        supabase = None

# --- ìˆ˜ì¤€ë³„ ì„¤ì • ---
LEVELS = {
    "ì´ˆë“±": {"name": "ì´ˆë“± (5~6í•™ë…„)", "initial_cash": 1_000_000, "grade_level": "ì´ˆë“±í•™ìƒ 5~6í•™ë…„"},
    "ì¤‘ë“±": {"name": "ì¤‘ë“± (1~3í•™ë…„)", "initial_cash": 5_000_000, "grade_level": "ì¤‘í•™ìƒ 1~3í•™ë…„"},
    "ê³ ë“±": {"name": "ê³ ë“± (1~3í•™ë…„)", "initial_cash": 10_000_000, "grade_level": "ê³ ë“±í•™ìƒ 1~3í•™ë…„"},
}

# --- ìˆ˜ì¤€ë³„ ì£¼ì‹ ì„¤ëª… ---
# (ê° ìˆ˜ì¤€ì— ë§ê²Œ ì„¤ëª…ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€)
STOCK_DESCRIPTIONS = {
    "ì´ˆë“±": {
        "ì‚¼ì„±ì „ì": "TV, ìŠ¤ë§ˆíŠ¸í° ë§Œë“œëŠ” íšŒì‚¬! ê°¤ëŸ­ì‹œ ì•Œì§€? ë°˜ë„ì²´ ì¹©ë„ ì„¸ê³„ ìµœê³ !",
        "SKí•˜ì´ë‹‰ìŠ¤": "ì»´í“¨í„°, ìŠ¤ë§ˆíŠ¸í°ì˜ ê¸°ì–µë ¥ ë‹´ë‹¹! ì‚¬ì§„, ì˜ìƒ ì €ì¥ ë„ì™€ì¤˜.",
        "LGë””ìŠ¤í”Œë ˆì´": "TV, ìŠ¤ë§ˆíŠ¸í° í™”ë©´ ë§Œë“œëŠ” íšŒì‚¬! OLED ê¸°ìˆ ë¡œ ì„ ëª…í•˜ê²Œ!",
        "í˜„ëŒ€ìë™ì°¨": "ìë™ì°¨ ë§Œë“œëŠ” íšŒì‚¬! ì˜ë‚˜íƒ€, ì•„ì´ì˜¤ë‹‰ ë“¤ì–´ë´¤ì§€? ì „ê¸°ì°¨ë„ ë§Œë“¤ì–´.",
        "ê¸°ì•„": "ë””ìì¸ ì˜ˆìœ ìë™ì°¨ íšŒì‚¬! K5, ì˜ë Œí† , EV6 ë©‹ì§€ì§€?",
        "í˜„ëŒ€ëª¨ë¹„ìŠ¤": "ìë™ì°¨ ë¶€í’ˆ ë§Œë“œëŠ” íšŒì‚¬! ì—”ì§„, ë¸Œë ˆì´í¬ ë“± ì•ˆì „ ë¶€í’ˆ ë‹´ë‹¹.",
        "LGì—ë„ˆì§€ì†”ë£¨ì…˜": "ì „ê¸°ì°¨ ë°°í„°ë¦¬ ì„¸ê³„ 1ë“±! ë¯¸ë˜ ì—ë„ˆì§€ ì±…ì„ì ¸.",
        "SKì´ë…¸ë² ì´ì…˜": "ê¸°ë¦„ ë§Œë“¤ê³ , í”Œë¼ìŠ¤í‹± ì›ë£Œë„ ë§Œë“¤ì–´. ì „ê¸°ì°¨ ë°°í„°ë¦¬ë„!",
        "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°": "ì „ê¸° ë§Œë“œëŠ” ë°œì „ì†Œ ì§“ëŠ” íšŒì‚¬! ì›ìë ¥, í’ë ¥ ë°œì „ì†Œë„.",
        "ë„¤ì´ë²„": "ê¶ê¸ˆí•œ ê±° ê²€ìƒ‰í•˜ëŠ” ë„¤ì´ë²„! ë‰´ìŠ¤, ì›¹íˆ°, ì‡¼í•‘ ë‹¤ ìˆì–´.",
        "ì¹´ì¹´ì˜¤": "ì¹´ì¹´ì˜¤í†¡ ë§Œë“  íšŒì‚¬! íƒì‹œ, í˜ì´, ê²Œì„ ë“± í¸ë¦¬í•œ ì„œë¹„ìŠ¤ ê°€ë“.",
        "ì¹´ì¹´ì˜¤ë±…í¬": "ìŠ¤ë§ˆíŠ¸í° ì€í–‰! ì•±ìœ¼ë¡œ ì‰½ê²Œ ëˆ ë³´ë‚´ê³  ê´€ë¦¬í•´.",
        "CJì œì¼ì œë‹¹": "ë§›ìˆëŠ” ìŒì‹ ë§Œë“œëŠ” íšŒì‚¬! í–‡ë°˜, ë¹„ë¹„ê³  ë§Œë‘ ì•Œì§€?",
        "ì•„ëª¨ë ˆí¼ì‹œí”½": "í™”ì¥í’ˆ ë§Œë“œëŠ” íšŒì‚¬! ì„¤í™”ìˆ˜, ì´ë‹ˆìŠ¤í”„ë¦¬ ë“¤ì–´ë´¤ì§€?",
        "LGìƒí™œê±´ê°•": "ìƒ´í‘¸, ì¹˜ì•½, í™”ì¥í’ˆ ë§Œë“œëŠ” íšŒì‚¬! ì½”ì¹´ì½œë¼ë„ íŒ”ì•„.",
        "KBê¸ˆìœµ": "KBêµ­ë¯¼ì€í–‰ ìˆëŠ” ê¸ˆìœµ íšŒì‚¬! ëˆ ê´€ë¦¬ ë„ì™€ì¤˜.",
        "ì‹ í•œì§€ì£¼": "ì‹ í•œì€í–‰ ìˆëŠ” ê¸ˆìœµ íšŒì‚¬! ì¹´ë“œ, ë³´í—˜ë„ ìˆì–´.",
        "í•˜ë‚˜ê¸ˆìœµì§€ì£¼": "í•˜ë‚˜ì€í–‰ ìˆëŠ” ê¸ˆìœµ íšŒì‚¬! ì™¸êµ­ ëˆ ê±°ë˜ ì˜í•´.",
        "ì‚¼ì„±ë¬¼ì‚°": "ê±´ë¬¼ ì§“ê³ , ì˜·ë„ íŒ”ê³ , ì—ë²„ëœë“œë„ ìš´ì˜í•´!",
        "HDí˜„ëŒ€": "í° ë°° ë§Œë“¤ê³ , êµ´ì°©ê¸° ê°™ì€ ê±´ì„¤ ê¸°ê³„ë„ ë§Œë“¤ì–´.",
        "GSê±´ì„¤": "ì•„íŒŒíŠ¸ 'ìì´' ì§“ëŠ” íšŒì‚¬! ì‚´ê¸° ì¢‹ì€ ì§‘ ë§Œë“¤ì–´.",
        "ë¡¯ë°ì‡¼í•‘": "ë¡¯ë°ë°±í™”ì , ë¡¯ë°ë§ˆíŠ¸ ìš´ì˜! ì‡¼í•‘ì€ ì—¬ê¸°ì„œ!",
        "ì´ë§ˆíŠ¸": "í° ë§ˆíŠ¸ ì´ë§ˆíŠ¸! ì—†ëŠ” ê±° ë¹¼ê³  ë‹¤ ìˆì–´. ë…¸ë¸Œëœë“œ ìœ ëª…í•´.",
        "KT": "ì¸í„°ë„·, ìŠ¤ë§ˆíŠ¸í° í†µì‹  íšŒì‚¬! ì „í™”, TV ì„œë¹„ìŠ¤ ì œê³µ.",
        "SKí…”ë ˆì½¤": "ìŠ¤ë§ˆíŠ¸í° í†µì‹  1ë“± íšŒì‚¬! ë¹ ë¥¸ 5G ì„œë¹„ìŠ¤ ì œê³µ.",
        "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤": "íŠ¹ë³„í•œ ì•½(ë°”ì´ì˜¤ ì˜ì•½í’ˆ) ë§Œë“œëŠ” íšŒì‚¬! ì•„í”ˆ ì‚¬ëŒ ë„ì™€ì¤˜.",
        "ì…€íŠ¸ë¦¬ì˜¨": "ë°”ì´ì˜¤ ì˜ì•½í’ˆ ê°œë°œí•˜ê³  ë§Œë“œëŠ” íšŒì‚¬! ë³‘ ì¹˜ë£Œ ë„ì™€ì¤˜.",
        "LGí™”í•™": "í”Œë¼ìŠ¤í‹±, ë°°í„°ë¦¬ ë§Œë“œëŠ” í™”í•™ íšŒì‚¬! ìƒí™œ ê³³ê³³ì— ìˆì–´.",
        "ê¸ˆí˜¸ì„ìœ í™”í•™": "íƒ€ì´ì–´ ì›ë£Œ(í•©ì„±ê³ ë¬´) ë§Œë“œëŠ” íšŒì‚¬! ì‚°ì—…ì— ê¼­ í•„ìš”í•´.",
        "POSCOí™€ë”©ìŠ¤": "íŠ¼íŠ¼í•œ ì²  ë§Œë“œëŠ” íšŒì‚¬! ìë™ì°¨, ê±´ë¬¼ì— ì“°ì—¬.",
        "í˜„ëŒ€ì œì² ": "ìë™ì°¨, ê±´ë¬¼ìš© ì²  ë§Œë“œëŠ” íšŒì‚¬! í˜„ëŒ€ì°¨ ê·¸ë£¹ì´ì•¼.",
        "ëŒ€í•œí•­ê³µ": "ë¹„í–‰ê¸° íšŒì‚¬! í•´ì™¸ì—¬í–‰ ê°ˆ ë•Œ íƒ€ëŠ” ë¹„í–‰ê¸°.",
        "HMM": "í° ë°°ë¡œ ë¬¼ê±´ ì‹¤ì–´ ë‚˜ë¥´ëŠ” íšŒì‚¬! ìˆ˜ì¶œì… ë„ì™€ì¤˜.",
        "CJ ENM": "tvN, Mnet ë°©ì†¡êµ­ ìš´ì˜! ì˜í™”, ìŒì•…ë„ ë§Œë“¤ì–´.",
        "í•˜ì´ë¸Œ": "BTS ì†Œì†ì‚¬! ì•„ì´ëŒ í‚¤ìš°ê³  ìŒì•… ë§Œë“¤ì–´.",
        "ì˜¤ë¦¬ì˜¨": "ì´ˆì½”íŒŒì´, í¬ì¹´ì¹© ë§Œë“œëŠ” ê³¼ì íšŒì‚¬!",
        "ë†ì‹¬": "ì‹ ë¼ë©´, ì§œíŒŒê²Œí‹° ë§Œë“œëŠ” ë¼ë©´ íšŒì‚¬!",
    },
    "ì¤‘ë“±": { # ì¤‘ë“± ìˆ˜ì¤€ ì„¤ëª… (ê¸°ì¡´ ì„¤ëª… í™œìš© ë˜ëŠ” ì•½ê°„ ìˆ˜ì •)
        "ì‚¼ì„±ì „ì": "ëŒ€í•œë¯¼êµ­ ëŒ€í‘œ ì „ì ê¸°ì—…. ìŠ¤ë§ˆíŠ¸í°(ê°¤ëŸ­ì‹œ), TV, ê°€ì „ì œí’ˆ ë° ë°˜ë„ì²´(ë©”ëª¨ë¦¬, ì‹œìŠ¤í…œLSI) ìƒì‚°. ê¸€ë¡œë²Œ ì‹œì¥ ì ìœ ìœ¨ ë†’ìŒ.",
        "SKí•˜ì´ë‹‰ìŠ¤": "ë©”ëª¨ë¦¬ ë°˜ë„ì²´(DRAM, NAND Flash) ì „ë¬¸ ê¸°ì—…. ë°ì´í„°ì„¼í„°, PC, ëª¨ë°”ì¼ ê¸°ê¸° ë“±ì— í•„ìˆ˜ì ì¸ ë¶€í’ˆ ê³µê¸‰.",
        "LGë””ìŠ¤í”Œë ˆì´": "ë””ìŠ¤í”Œë ˆì´ íŒ¨ë„(OLED, LCD) ìƒì‚° ê¸°ì—…. TV, ìŠ¤ë§ˆíŠ¸í°, ë…¸íŠ¸ë¶, ì°¨ëŸ‰ìš© ë””ìŠ¤í”Œë ˆì´ ë“±ì— ì‚¬ìš©. OLED ê¸°ìˆ  ì„ ë„.",
        "í˜„ëŒ€ìë™ì°¨": "êµ­ë‚´ 1ìœ„, ê¸€ë¡œë²Œ ìƒìœ„ê¶Œ ìë™ì°¨ ì œì¡°ì‚¬. ë‚´ì—°ê¸°ê´€ì°¨, ì „ê¸°ì°¨(ì•„ì´ì˜¤ë‹‰), ìˆ˜ì†Œì°¨(ë„¥ì˜) ë“± ë‹¤ì–‘í•œ ë¼ì¸ì—… ë³´ìœ .",
        "ê¸°ì•„": "í˜„ëŒ€ì°¨ê·¸ë£¹ ê³„ì—´ ìë™ì°¨ ì œì¡°ì‚¬. Kì‹œë¦¬ì¦ˆ, ì˜ë Œí† , ìŠ¤í¬í‹°ì§€ ë“± ì¸ê¸° ëª¨ë¸ ë³´ìœ . ë””ìì¸ ê²½ìŸë ¥ ê°•ì¡° ë° ì „ê¸°ì°¨(EV) ë¼ì¸ì—… í™•ì¥ ì¤‘.",
        "í˜„ëŒ€ëª¨ë¹„ìŠ¤": "í˜„ëŒ€ì°¨ê·¸ë£¹ í•µì‹¬ ë¶€í’ˆ ê³„ì—´ì‚¬. ìë™ì°¨ ëª¨ë“ˆ, í•µì‹¬ ë¶€í’ˆ(ì „ë™í™”, ë¨í”„ ë“±), A/S ë¶€í’ˆ ì‚¬ì—… ì˜ìœ„.",
        "LGì—ë„ˆì§€ì†”ë£¨ì…˜": "ê¸€ë¡œë²Œ ì „ê¸°ì°¨ ë°°í„°ë¦¬ ì‹œì¥ ì„ ë‘ ê¸°ì—…. íŒŒìš°ì¹˜í˜• ë°°í„°ë¦¬ ê°•ì . GM, í˜„ëŒ€ì°¨ ë“± ë‹¤ìˆ˜ ì™„ì„±ì°¨ ì—…ì²´ì— ê³µê¸‰.",
        "SKì´ë…¸ë² ì´ì…˜": "ì •ìœ , ì„ìœ í™”í•™, ìœ¤í™œìœ  ë° ë°°í„°ë¦¬ ì‚¬ì—… ì˜ìœ„. SKì˜¨ì„ í†µí•´ ì „ê¸°ì°¨ ë°°í„°ë¦¬ ì‚¬ì—… í™•ì¥ ì¤‘.",
        "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°": "ë°œì „ ì„¤ë¹„(ì›ìë ¥, í™”ë ¥, í’ë ¥ ë“±) ë° í”ŒëœíŠ¸ ê±´ì„¤ ì „ë¬¸ ê¸°ì—…. í•´ìˆ˜ë‹´ìˆ˜í™”, SMR(ì†Œí˜•ëª¨ë“ˆì›ì „), ê°€ìŠ¤í„°ë¹ˆ ë“± ì‹ ì‚¬ì—… ì¶”ì§„.",
        "ë„¤ì´ë²„": "êµ­ë‚´ 1ìœ„ ê²€ìƒ‰ í¬í„¸. ê²€ìƒ‰, ì»¤ë¨¸ìŠ¤, í•€í…Œí¬(ë„¤ì´ë²„í˜ì´), ì½˜í…ì¸ (ì›¹íˆ°), í´ë¼ìš°ë“œ ë“± ë‹¤ì–‘í•œ ì¸í„°ë„· ì„œë¹„ìŠ¤ ì œê³µ.",
        "ì¹´ì¹´ì˜¤": "êµ­ë¯¼ ë©”ì‹ ì € ì¹´ì¹´ì˜¤í†¡ ê¸°ë°˜ í”Œë«í¼ ê¸°ì—…. ëª¨ë¹Œë¦¬í‹°, í˜ì´, ê²Œì„, ì›¹íˆ°, ë±…í¬ ë“± ë‹¤ì–‘í•œ ìƒí™œ ë°€ì°©í˜• ì„œë¹„ìŠ¤ í™•ì¥.",
        "ì¹´ì¹´ì˜¤ë±…í¬": "ì¸í„°ë„· ì „ë¬¸ ì€í–‰. ë¹„ëŒ€ë©´ ê¸ˆìœµ ì„œë¹„ìŠ¤ ê°•ì . ê°„í¸ ì†¡ê¸ˆ, ëŒ€ì¶œ, ì˜ˆì ê¸ˆ ìƒí’ˆ ì œê³µ. í”Œë«í¼ ê¸°ë°˜ ì„±ì¥ ì¶”êµ¬.",
        "CJì œì¼ì œë‹¹": "êµ­ë‚´ ëŒ€í‘œ ì‹í’ˆ ê¸°ì—…. í–‡ë°˜, ë¹„ë¹„ê³  ë“± HMR(ê°€ì •ê°„í¸ì‹) ê°•ì. ë°”ì´ì˜¤(ì•„ë¯¸ë…¸ì‚° ë“±), ì‚¬ë£Œ ì‚¬ì—…ë„ ì˜ìœ„. ê¸€ë¡œë²Œ í™•ì¥ ì¤‘.",
        "ì•„ëª¨ë ˆí¼ì‹œí”½": "êµ­ë‚´ 1ìœ„ í™”ì¥í’ˆ ê¸°ì—…. ì„¤í™”ìˆ˜, ë¼ë„¤ì¦ˆ, ì´ë‹ˆìŠ¤í”„ë¦¬ ë“± ë‹¤ìˆ˜ ë¸Œëœë“œ ë³´ìœ . ì¤‘êµ­ ì‹œì¥ ì˜ì¡´ë„ ë†’ì•˜ìœ¼ë‚˜ ë‹¤ë³€í™” ë…¸ë ¥ ì¤‘.",
        "LGìƒí™œê±´ê°•": "í™”ì¥í’ˆ(í›„, ìˆ¨, ì˜¤íœ˜), ìƒí™œìš©í’ˆ(í˜ë¦¬ì˜¤, ì—˜ë¼ìŠ¤í‹´), ìŒë£Œ(ì½”ì¹´ì½œë¼) ì‚¬ì—… ì˜ìœ„. ëŸ­ì…”ë¦¬ í™”ì¥í’ˆ ê°•ì .",
        "KBê¸ˆìœµ": "êµ­ë‚´ ë¦¬ë”© ê¸ˆìœµì§€ì£¼ì‚¬. KBêµ­ë¯¼ì€í–‰, KBì¦ê¶Œ, KBì†í•´ë³´í—˜ ë“± ê³„ì—´ì‚¬ ë³´ìœ . ì€í–‰ ì¤‘ì‹¬ ì•ˆì •ì  ìˆ˜ìµ êµ¬ì¡°.",
        "ì‹ í•œì§€ì£¼": "KBê¸ˆìœµê³¼ ê²½ìŸí•˜ëŠ” ë¦¬ë”© ê¸ˆìœµì§€ì£¼ì‚¬. ì‹ í•œì€í–‰, ì‹ í•œì¹´ë“œ, ì‹ í•œê¸ˆìœµíˆ¬ì ë“± ë³´ìœ . ë¹„ì€í–‰ ë¶€ë¬¸ ê²½ìŸë ¥ ê°•í™” ë…¸ë ¥.",
        "í•˜ë‚˜ê¸ˆìœµì§€ì£¼": "ì£¼ìš” ê¸ˆìœµì§€ì£¼ì‚¬ ì¤‘ í•˜ë‚˜. í•˜ë‚˜ì€í–‰, í•˜ë‚˜ì¦ê¶Œ, í•˜ë‚˜ì¹´ë“œ ë“± ë³´ìœ . ì™¸í™˜ ë° ê¸€ë¡œë²Œ ë¶€ë¬¸ ê°•ì .",
        "ì‚¼ì„±ë¬¼ì‚°": "ì‚¼ì„±ê·¸ë£¹ ì§€ë°°êµ¬ì¡° í•µì‹¬. ê±´ì„¤(ë˜ë¯¸ì•ˆ), ìƒì‚¬, íŒ¨ì…˜(ë¹ˆí´), ë¦¬ì¡°íŠ¸(ì—ë²„ëœë“œ), ë°”ì´ì˜¤(ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤ ì§€ë¶„) ë“± ë‹¤ì–‘í•œ ì‚¬ì—… ì˜ìœ„.",
        "HDí˜„ëŒ€": "ì¡°ì„ (HDí•œêµ­ì¡°ì„ í•´ì–‘), ê±´ì„¤ê¸°ê³„(HDí˜„ëŒ€ì¸í”„ë¼ì½”ì–´, HDí˜„ëŒ€ê±´ì„¤ê¸°ê³„), ì—ë„ˆì§€(HDí˜„ëŒ€ì˜¤ì¼ë±…í¬) ë“± ì¤‘ê³µì—… ì¤‘ì‹¬ ê·¸ë£¹ ì§€ì£¼ì‚¬.",
        "GSê±´ì„¤": "ì£¼íƒ ë¸Œëœë“œ 'ìì´'ë¡œ ìœ ëª…í•œ ëŒ€í˜• ê±´ì„¤ì‚¬. ì£¼íƒ, ê±´ì¶•, í”ŒëœíŠ¸, ì¸í”„ë¼ ë“± ë‹¤ì–‘í•œ ê±´ì„¤ ì‚¬ì—… ì˜ìœ„.",
        "ë¡¯ë°ì‡¼í•‘": "ë¡¯ë°ê·¸ë£¹ ìœ í†µ ë¶€ë¬¸ í•µì‹¬. ë°±í™”ì , ë§ˆíŠ¸, ìŠˆí¼, ì•„ìš¸ë ›, ì´ì»¤ë¨¸ìŠ¤(ë¡¯ë°ON) ë“± ìš´ì˜. ì˜¤í”„ë¼ì¸ ì±„ë„ ê°•ì .",
        "ì´ë§ˆíŠ¸": "ì‹ ì„¸ê³„ê·¸ë£¹ ê³„ì—´ êµ­ë‚´ 1ìœ„ ëŒ€í˜•ë§ˆíŠ¸. ì°½ê³ í˜• í• ì¸ì (íŠ¸ë ˆì´ë”ìŠ¤), ì „ë¬¸ì (ë…¸ë¸Œëœë“œ), ì˜¨ë¼ì¸(SSGë‹·ì»´) ë“± ìš´ì˜.",
        "KT": "ìœ ë¬´ì„  í†µì‹  ì„œë¹„ìŠ¤ ì œê³µ. ì¸í„°ë„·, IPTV, ì´ë™í†µì‹  ë“±. B2B(í´ë¼ìš°ë“œ, AI) ë° ë¯¸ë””ì–´/ì½˜í…ì¸  ì‚¬ì—… í™•ì¥ ì¤‘.",
        "SKí…”ë ˆì½¤": "êµ­ë‚´ 1ìœ„ ì´ë™í†µì‹ ì‚¬. 5G ë„¤íŠ¸ì›Œí¬ ê²½ìŸë ¥. AI, ë©”íƒ€ë²„ìŠ¤, êµ¬ë… ì„œë¹„ìŠ¤ ë“± ì‹ ì„±ì¥ ë™ë ¥ ë°œêµ´.",
        "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤": "ë°”ì´ì˜¤ì˜ì•½í’ˆ ìœ„íƒê°œë°œìƒì‚°(CDMO) ì „ë¬¸ ê¸°ì—…. ê¸€ë¡œë²Œ ìµœëŒ€ ê·œëª¨ ìƒì‚° ëŠ¥ë ¥ ë³´ìœ . ë†’ì€ ê¸°ìˆ ë ¥ê³¼ ì‹ ë¢°ë„ ê°•ì .",
        "ì…€íŠ¸ë¦¬ì˜¨": "ë°”ì´ì˜¤ì‹œë°€ëŸ¬(ë°”ì´ì˜¤ì˜ì•½í’ˆ ë³µì œì•½) ê°œë°œ ë° ìƒì‚° ê¸°ì—…. ë¨ì‹œë§ˆ, íŠ¸ë£©ì‹œë§ˆ ë“± ê¸€ë¡œë²Œ ì‹œì¥ íŒë§¤. ì‹ ì•½ ê°œë°œë„ ì¶”ì§„.",
        "LGí™”í•™": "ì„ìœ í™”í•™, ì²¨ë‹¨ì†Œì¬(ë°°í„°ë¦¬ ì†Œì¬ ë“±), ìƒëª…ê³¼í•™ ì‚¬ì—… ì˜ìœ„. ë°°í„°ë¦¬ ì†Œì¬ ë¶€ë¬¸ ì„±ì¥ì„± ì£¼ëª©.",
        "ê¸ˆí˜¸ì„ìœ í™”í•™": "í•©ì„±ê³ ë¬´(íƒ€ì´ì–´ ì›ë£Œ), í•©ì„±ìˆ˜ì§€(í”Œë¼ìŠ¤í‹± ì›ë£Œ) ì£¼ë ¥ í™”í•™ ê¸°ì—…. í˜ë†€ìœ ë„ì²´ ë“± ì •ë°€í™”í•™ ì œí’ˆë„ ìƒì‚°.",
        "POSCOí™€ë”©ìŠ¤": "êµ­ë‚´ 1ìœ„, ê¸€ë¡œë²Œ ê²½ìŸë ¥ ê°–ì¶˜ ì² ê°• ê¸°ì—… í¬ìŠ¤ì½”ì˜ ì§€ì£¼ì‚¬. ì² ê°• ì™¸ ì´ì°¨ì „ì§€ì†Œì¬, ìˆ˜ì†Œ ë“± ì¹œí™˜ê²½ ë¯¸ë˜ì†Œì¬ ì‚¬ì—… ìœ¡ì„±.",
        "í˜„ëŒ€ì œì² ": "í˜„ëŒ€ì°¨ê·¸ë£¹ ê³„ì—´ ì² ê°•ì‚¬. ìë™ì°¨ ê°•íŒ, ê±´ì„¤ìš© í˜•ê°•/ì² ê·¼ ë“± ìƒì‚°. ì „ê¸°ë¡œ ê¸°ë°˜ ì¹œí™˜ê²½ ìƒì‚° ì „í™˜ ì¶”ì§„.",
        "ëŒ€í•œí•­ê³µ": "êµ­ë‚´ 1ìœ„, FSC(Full Service Carrier) í•­ê³µì‚¬. ì—¬ê° ë° í™”ë¬¼ ìš´ì†¡ ì‚¬ì—…. ì•„ì‹œì•„ë‚˜í•­ê³µ ì¸ìˆ˜ ì¶”ì§„ ì¤‘.",
        "HMM": "êµ­ë‚´ ìµœëŒ€ ì»¨í…Œì´ë„ˆ ì„ ì‚¬. ê¸€ë¡œë²Œ í•´ìš´ ì–¼ë¼ì´ì–¸ìŠ¤ 'ë”” ì–¼ë¼ì´ì–¸ìŠ¤' íšŒì›ì‚¬. í•´ìš´ ì‹œí™©ì— ë”°ë¥¸ ì‹¤ì  ë³€ë™ì„± í¼.",
        "CJ ENM": "ë¯¸ë””ì–´(tvN, Mnet), ì˜í™”(CJì—”í„°í…Œì¸ë¨¼íŠ¸), ìŒì•…(ìŠ¤í†¤ë®¤ì§), ì»¤ë¨¸ìŠ¤ ì‚¬ì—… ì˜ìœ„. ì½˜í…ì¸  ì œì‘ ë° ìœ í†µ ì—­ëŸ‰ ë³´ìœ .",
        "í•˜ì´ë¸Œ": "BTS ì†Œì†ì‚¬ë¡œ ì‹œì‘í•œ ê¸€ë¡œë²Œ ì—”í„°í…Œì¸ë¨¼íŠ¸ ê¸°ì—…. ë©€í‹° ë ˆì´ë¸” ì²´ì œ. ìœ„ë²„ìŠ¤ í”Œë«í¼ ê¸°ë°˜ íŒ¬ë¤ ë¹„ì¦ˆë‹ˆìŠ¤ í™•ì¥.",
        "ì˜¤ë¦¬ì˜¨": "ì´ˆì½”íŒŒì´ë¡œ ìœ ëª…í•œ ì œê³¼ ê¸°ì—…. ì¤‘êµ­, ë² íŠ¸ë‚¨, ëŸ¬ì‹œì•„ ë“± í•´ì™¸ ì‹œì¥ ì„±ê³µì  ì§„ì¶œ. ê°„í¸ëŒ€ìš©ì‹, ë°”ì´ì˜¤ ì‚¬ì—… ì§„ì¶œ ëª¨ìƒ‰.",
        "ë†ì‹¬": "ì‹ ë¼ë©´, ì§œíŒŒê²Œí‹° ë“± ëŒ€í‘œ ë¼ë©´ ë¸Œëœë“œ ë³´ìœ . ìŠ¤ë‚µ(ìƒˆìš°ê¹¡ ë“±), ìŒë£Œ ì‚¬ì—…ë„ ì˜ìœ„. í•´ì™¸ ì‹œì¥, íŠ¹íˆ ë¯¸êµ­ ì„±ì¥ì„¸ ì£¼ëª©.",
    },
    "ê³ ë“±": { # ê³ ë“± ìˆ˜ì¤€ ì„¤ëª… (ê¸°ì¡´ ì„¤ëª… + ì‹¬í™” ë‚´ìš©)
        "ì‚¼ì„±ì „ì": "ê¸€ë¡œë²Œ IT ë¦¬ë”. DX(Device eXperience: ìŠ¤ë§ˆíŠ¸í°, ê°€ì „)ì™€ DS(Device Solutions: ë°˜ë„ì²´) ë¶€ë¬¸ ì˜ìœ„. íŒŒìš´ë“œë¦¬ ê²½ìŸë ¥ ê°•í™” ë° AI ë°˜ë„ì²´ ì‹œì¥ ëŒ€ì‘ ì¤‘ìš”.",
        "SKí•˜ì´ë‹‰ìŠ¤": "ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ê°•ì. HBM(ê³ ëŒ€ì—­í­ë©”ëª¨ë¦¬) ë“± AI ì„œë²„ìš© ê³ ì„±ëŠ¥ ë©”ëª¨ë¦¬ ìˆ˜ìš” ì¦ê°€ ìˆ˜í˜œ ê¸°ëŒ€. NAND ì‹œì¥ ì—…í™© íšŒë³µ ì£¼ëª©.",
        "LGë””ìŠ¤í”Œë ˆì´": "ëŒ€í˜• OLED ì‹œì¥ ì£¼ë„. ITìš© OLED ë° ì°¨ëŸ‰ìš© P-OLED ë“± ì‹ ì‹œì¥ ê°œì²™. LCD ì‚¬ì—… ì¶•ì†Œ ë° OLED ì „í™˜ ê°€ì†í™”.",
        "í˜„ëŒ€ìë™ì°¨": "ê¸€ë¡œë²Œ ì™„ì„±ì°¨ ì—…ì²´. ì „ìš© ì „ê¸°ì°¨ í”Œë«í¼ E-GMP ê¸°ë°˜ ì•„ì´ì˜¤ë‹‰ ì‹œë¦¬ì¦ˆ í˜¸í‰. SDV(ì†Œí”„íŠ¸ì›¨ì–´ ì¤‘ì‹¬ ìë™ì°¨) ì „í™˜ ë° ë¯¸ë˜ ëª¨ë¹Œë¦¬í‹°(UAM, ë¡œë³´í‹±ìŠ¤) íˆ¬ì í™•ëŒ€.",
        "ê¸°ì•„": "í˜„ëŒ€ì°¨ê·¸ë£¹ ë‚´ ë””ìì¸ ë° EV íŠ¹í™” ë¸Œëœë“œ. EV ë¼ì¸ì—… ì„±ê³µì  ì•ˆì°©. PBV(ëª©ì ê¸°ë°˜ëª¨ë¹Œë¦¬í‹°) ì‹œì¥ ì„ ì  ëª©í‘œ.",
        "í˜„ëŒ€ëª¨ë¹„ìŠ¤": "ìë™ì°¨ í•µì‹¬ ë¶€í’ˆ ê³µê¸‰ì‚¬. ì „ë™í™”, ììœ¨ì£¼í–‰ ê´€ë ¨ í•µì‹¬ ê¸°ìˆ  ë‚´ì¬í™” ë…¸ë ¥. ê·¸ë£¹ì‚¬ ì™¸ ìˆ˜ì£¼ í™•ëŒ€ ë° ì†Œí”„íŠ¸ì›¨ì–´ ì—­ëŸ‰ ê°•í™” í•„ìš”.",
        "LGì—ë„ˆì§€ì†”ë£¨ì…˜": "ê¸€ë¡œë²Œ Top-tier ë°°í„°ë¦¬ ì…€ ì œì¡°ì‚¬. ë¶ë¯¸ ì¤‘ì‹¬ ìƒì‚° ëŠ¥ë ¥ í™•ëŒ€. ì›í†µí˜•, íŒŒìš°ì¹˜í˜•, LFP ë“± ë‹¤ì–‘í•œ í¼íŒ©í„° ë° ì†Œì¬ ê¸°ìˆ  ë³´ìœ . IRA ìˆ˜í˜œ ê¸°ëŒ€.",
        "SKì´ë…¸ë² ì´ì…˜": "ì •ìœ /í™”í•™ ê¸°ë°˜ ì—ë„ˆì§€ ê¸°ì—…. ë°°í„°ë¦¬ ìíšŒì‚¬ SKì˜¨ì˜ í‘ì ì „í™˜ ë° IPO ì¶”ì§„ ì¤‘ìš”. ì¹´ë³¸ íˆ¬ ê·¸ë¦°(Carbon to Green) ì „ëµ ì‹¤í–‰.",
        "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°": "ì „ë ¥ ì¸í”„ë¼ í•µì‹¬ ê¸°ì—…. ì›ì „ ìƒíƒœê³„ ë³µì› ë° SMR ê¸°ìˆ  ê°œë°œ ì„ ë„. ê°€ìŠ¤í„°ë¹ˆ êµ­ì‚°í™” ë° ìˆ˜ì†Œ, í’ë ¥ ë“± ì¹œí™˜ê²½ ì—ë„ˆì§€ í¬íŠ¸í´ë¦¬ì˜¤ ê°•í™”.",
        "ë„¤ì´ë²„": "êµ­ë‚´ ìµœëŒ€ ì¸í„°ë„· í”Œë«í¼. ê²€ìƒ‰ ê´‘ê³ , ì»¤ë¨¸ìŠ¤ ì¤‘ì‹¬ ì•ˆì •ì  ì„±ì¥. AI(í•˜ì´í¼í´ë¡œë°”X), í´ë¼ìš°ë“œ, ì›¹íˆ° ê¸€ë¡œë²Œ í™•ì¥ ë“± ë¯¸ë˜ ì„±ì¥ ë™ë ¥ í™•ë³´ ë…¸ë ¥.",
        "ì¹´ì¹´ì˜¤": "ëª¨ë°”ì¼ í”Œë«í¼ ê¸°ë°˜ ì„œë¹„ìŠ¤ í™•ì¥. ì¹´ì¹´ì˜¤í†¡ ì±„ë„ ë° ê´‘ê³  ìˆ˜ìµí™”. ëª¨ë¹Œë¦¬í‹°, í˜ì´ ë“± ì£¼ìš” ìíšŒì‚¬ ìˆ˜ìµì„± ê°œì„  ë° ê·œì œ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì¤‘ìš”.",
        "ì¹´ì¹´ì˜¤ë±…í¬": "ëŒ€í‘œì ì¸ ì¸í„°ë„· ì „ë¬¸ ì€í–‰. ì¤‘ì €ì‹ ìš©ì ëŒ€ì¶œ í™•ëŒ€ ë° í”Œë«í¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê°•í™”. ê¸ˆë¦¬ í™˜ê²½ ë³€í™” ë° í•€í…Œí¬ ê²½ìŸ ì‹¬í™” ëŒ€ì‘ í•„ìš”.",
        "CJì œì¼ì œë‹¹": "ì‹í’ˆ(K-Food ê¸€ë¡œë²Œ í™•ì‚°), ë°”ì´ì˜¤(ìŠ¤í˜ì…œí‹° ì•„ë¯¸ë…¸ì‚°), F&C(ì‚¬ë£Œ) ì‚¬ì—… í¬íŠ¸í´ë¦¬ì˜¤. ìˆ˜ìµì„± ì¤‘ì‹¬ ê²½ì˜ ë° ì¬ë¬´êµ¬ì¡° ê°œì„  ë…¸ë ¥.",
        "ì•„ëª¨ë ˆí¼ì‹œí”½": "í™”ì¥í’ˆ ì‚°ì—… ëŒ€í‘œ ê¸°ì—…. ì¤‘êµ­ ì˜ì¡´ë„ ì¶•ì†Œ ë° ë¶ë¯¸, ìœ ëŸ½ ë“± ì‹ ì‹œì¥ ê°œì²™. ì˜¨ë¼ì¸ ì±„ë„ ê°•í™” ë° ë¸Œëœë“œ ë¦¬ë¹Œë”© ì§„í–‰ ì¤‘.",
        "LGìƒí™œê±´ê°•": "í™”ì¥í’ˆ, ìƒí™œìš©í’ˆ, ìŒë£Œ 3ê°œ ë¶€ë¬¸ ì•ˆì •ì  ì‚¬ì—… êµ¬ì¡°. ì¤‘êµ­ ë¦¬ì˜¤í”„ë‹ íš¨ê³¼ ë° ë¶ë¯¸ ì‚¬ì—… ì„±ê³¼ ì£¼ëª©. ë¸Œëœë“œ í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬ ì¤‘ìš”.",
        "KBê¸ˆìœµ": "ë¦¬ë”© ê¸ˆìœµê·¸ë£¹. ì€í–‰ì˜ ì•ˆì •ì  ì´ìµ ê¸°ë°˜ ìœ„ì— ë¹„ì€í–‰(ì¦ê¶Œ, ë³´í—˜, ì¹´ë“œ) ì‹œë„ˆì§€ ì°½ì¶œ. ë””ì§€í„¸ ì „í™˜ ë° ë¹„ê¸ˆìœµ í”Œë«í¼ í™•ì¥ ë…¸ë ¥.",
        "ì‹ í•œì§€ì£¼": "ê· í˜• ì¡íŒ ì‚¬ì—… í¬íŠ¸í´ë¦¬ì˜¤. ë¹„ì€í–‰ ë¶€ë¬¸ ì´ìµ ê¸°ì—¬ë„ ì¦ëŒ€ ë…¸ë ¥. ê¸€ë¡œë²Œ ë° ìë³¸ì‹œì¥ ë¶€ë¬¸ ê²½ìŸë ¥ ê°•í™”. ì£¼ì£¼í™˜ì› ì •ì±… í™•ëŒ€.",
        "í•˜ë‚˜ê¸ˆìœµì§€ì£¼": "ì€í–‰ ì¤‘ì‹¬ ê¸ˆìœµê·¸ë£¹. ê¸°ì—…ê¸ˆìœµ ë° ì™¸í™˜ ë¶€ë¬¸ ê°•ì . ë¹„ì€í–‰ ê²½ìŸë ¥ ê°•í™” ë° ë””ì§€í„¸ ê¸ˆìœµ í˜ì‹  ì¶”ì§„.",
        "ì‚¼ì„±ë¬¼ì‚°": "ì‚¼ì„±ê·¸ë£¹ ì‚¬ì‹¤ìƒ ì§€ì£¼íšŒì‚¬ ì—­í• . ë³´ìœ  ì§€ë¶„ ê°€ì¹˜(ì‚¼ì„±ì „ì, ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤ ë“±) ì¤‘ìš”. ê±´ì„¤ ìˆ˜ì£¼ ë° ìƒì‚¬ íŠ¸ë ˆì´ë”© ì‹¤ì , ì‹ ì‚¬ì—…(ì¹œí™˜ê²½ ì—ë„ˆì§€ ë“±) ì„±ê³¼ ì£¼ëª©.",
        "HDí˜„ëŒ€": "ì¡°ì„  ë¶€ë¬¸ ì—…í™© ê°œì„  ìˆ˜í˜œ. ê±´ì„¤ê¸°ê³„ ë¶ë¯¸/ì‹ í¥êµ­ ì¸í”„ë¼ íˆ¬ì ìˆ˜í˜œ. ì •ìœ  ë¶€ë¬¸ ì‹¤ì  ì•ˆì •í™” ë° ë¡œë´‡, AI ë“± ì‹ ê¸°ìˆ  íˆ¬ì.",
        "GSê±´ì„¤": "ì£¼íƒ ì‹œì¥ ë³€ë™ì„± ì˜í–¥. í•´ì™¸ í”ŒëœíŠ¸ ìˆ˜ì£¼ ë° ì‹ ì‚¬ì—…(ëª¨ë“ˆëŸ¬ ì£¼íƒ, ìˆ˜ì²˜ë¦¬ ë“±) ì„±ê³¼ ì¤‘ìš”. ì¬ë¬´ ê±´ì „ì„± ê´€ë¦¬ í•„ìš”.",
        "ë¡¯ë°ì‡¼í•‘": "ë°±í™”ì , ë§ˆíŠ¸ ë“± ì˜¤í”„ë¼ì¸ ìœ í†µ ê°•ì. ì´ì»¤ë¨¸ìŠ¤(ë¡¯ë°ON) ê²½ìŸë ¥ ê°•í™” ë° ìˆ˜ìµì„± ê°œì„  ê³¼ì œ. í•´ì™¸ ì‚¬ì—…(ë² íŠ¸ë‚¨ ë“±) ì„±ê³¼ ì£¼ëª©.",
        "ì´ë§ˆíŠ¸": "ì˜¤í”„ë¼ì¸ í• ì¸ì  ê²½ìŸë ¥ ìœ ì§€ ë° ì˜¨ë¼ì¸(SSGë‹·ì»´, Gë§ˆì¼“) ì‹œë„ˆì§€ ì°½ì¶œ ë…¸ë ¥. SCKì»´í¼ë‹ˆ(ìŠ¤íƒ€ë²…ìŠ¤) ì‹¤ì  ê¸°ì—¬. ìˆ˜ìµì„± ê°œì„  ì§‘ì¤‘.",
        "KT": "í†µì‹  ë³¸ì—… ì•ˆì •ì„± ê¸°ë°˜ ë¹„í†µì‹ (ë¯¸ë””ì–´, í´ë¼ìš°ë“œ, AI) ì„±ì¥ ì¶”êµ¬. CEO ë¦¬ìŠ¤í¬ í•´ì†Œ í›„ ì„±ì¥ ì „ëµ êµ¬ì²´í™”. ì£¼ì£¼í™˜ì› ì •ì±… ìœ ì§€.",
        "SKí…”ë ˆì½¤": "ê²¬ì¡°í•œ ë¬´ì„  ì‚¬ì—… ì‹¤ì . AI ì»´í¼ë‹ˆ ì „í™˜ ëª©í‘œ(ì—ì´ë‹· ë“±). Tìš°ì£¼(êµ¬ë…), ì´í”„ëœë“œ(ë©”íƒ€ë²„ìŠ¤) ë“± ì‹ ì‚¬ì—… ì„±ê³¼ ê°€ì‹œí™” í•„ìš”.",
        "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤": "ê¸€ë¡œë²Œ CDMO ì‹œì¥ ì§€ë°°ë ¥ ê°•í™”. 4ê³µì¥ ê°€ë™ ë° 5ê³µì¥ ì¦ì„¤ ê³„íš. ADC(í•­ì²´-ì•½ë¬¼ ì ‘í•©ì²´) ë“± ì°¨ì„¸ëŒ€ ê¸°ìˆ  íˆ¬ì.",
        "ì…€íŠ¸ë¦¬ì˜¨": "ë°”ì´ì˜¤ì‹œë°€ëŸ¬ í¼ìŠ¤íŠ¸ë¬´ë²„. ë¯¸êµ­ ì‹œì¥ ì§íŒ ì²´ì œ êµ¬ì¶•. íœ´ë¯¸ë¼, ìŠ¤í…”ë¼ë¼ ë“± ë¸”ë¡ë²„ìŠ¤í„° ë°”ì´ì˜¤ì‹œë°€ëŸ¬ ì¶œì‹œ ì˜ˆì •. ì‹ ì•½ ê°œë°œ ì—­ëŸ‰ ê°•í™”.",
        "LGí™”í•™": "ê¸°ì´ˆì†Œì¬(ì„ìœ í™”í•™), ì²¨ë‹¨ì†Œì¬(ì–‘ê·¹ì¬ ë“±), ìƒëª…ê³¼í•™ ì‚¬ì—… ì˜ìœ„. LGì—ë„ˆì§€ì†”ë£¨ì…˜ ì§€ë¶„ ê°€ì¹˜ ë°˜ì˜. ì¹œí™˜ê²½ ì†Œì¬ ë° ë°°í„°ë¦¬ ì†Œì¬ ì§‘ì¤‘ ìœ¡ì„±.",
        "ê¸ˆí˜¸ì„ìœ í™”í•™": "í•©ì„±ê³ ë¬´/ìˆ˜ì§€ ë“± ì£¼ë ¥ ì œí’ˆ ì‹œí™© ì¤‘ìš”. NBë¼í…ìŠ¤(ì˜ë£Œìš© ì¥ê°‘ ì†Œì¬) ìˆ˜ìš” ë³€í™” ì£¼ëª©. ì£¼ì£¼í™˜ì› ì •ì±… ë° ì‹ ì„±ì¥ ë™ë ¥ í™•ë³´ ë…¸ë ¥.",
        "POSCOí™€ë”©ìŠ¤": "ì² ê°• ì‚¬ì—… ì•ˆì •ì„± ë° ì¹œí™˜ê²½ ì „í™˜. ì´ì°¨ì „ì§€ì†Œì¬(ë¦¬íŠ¬, ë‹ˆì¼ˆ, ì–‘/ìŒê·¹ì¬) ë°¸ë¥˜ì²´ì¸ êµ¬ì¶• ê°€ì†í™”. ìˆ˜ì†Œ ì‚¬ì—… ë¹„ì „ ì œì‹œ.",
        "í˜„ëŒ€ì œì² ": "ìë™ì°¨ ê°•íŒ ë“± ê·¸ë£¹ì‚¬ ë¬¼ëŸ‰ ê¸°ë°˜ ì•ˆì •ì  ì‹¤ì . ê±´ì„¤ ì‹œí™© ì˜í–¥. íƒ„ì†Œì¤‘ë¦½ ëª©í‘œ ë‹¬ì„± ìœ„í•œ ìˆ˜ì†Œí™˜ì›ì œì²  ê¸°ìˆ  ê°œë°œ ì¤‘ìš”.",
        "ëŒ€í•œí•­ê³µ": "ì—¬ê° ìˆ˜ìš” íšŒë³µ ë° ê²¬ì¡°í•œ í™”ë¬¼ ì‹¤ì . ìœ ê°€ ë° í™˜ìœ¨ ë³€ë™ì„± ì˜í–¥. ì•„ì‹œì•„ë‚˜í•­ê³µ ì¸ìˆ˜ ê´€ë ¨ ë¶ˆí™•ì‹¤ì„± í•´ì†Œ í•„ìš”.",
        "HMM": "ì»¨í…Œì´ë„ˆ ìš´ì„ ì‹œí™© ë¯¼ê°. ì„ ëŒ€ í™•ì¥ ë° íš¨ìœ¨í™” ë…¸ë ¥. ë§¤ê° ì´ìŠˆ ë° ê¸€ë¡œë²Œ í•´ìš´ ë™ë§¹ ì¬í¸ ì˜í–¥ ì£¼ëª©.",
        "CJ ENM": "ë°©ì†¡ ê´‘ê³  ì‹œì¥ ë‘”í™” ì˜í–¥. í‹°ë¹™(OTT) ì„±ì¥ ë° ìˆ˜ìµì„± ê°œì„  ê³¼ì œ. í”¼í”„ìŠ¤ì‹œì¦Œ(ë¯¸êµ­ ì œì‘ì‚¬) ë“± ê¸€ë¡œë²Œ ì½˜í…ì¸  ê²½ìŸë ¥ ê°•í™”.",
        "í•˜ì´ë¸Œ": "ë©€í‹° ë ˆì´ë¸” ì²´ì œ ì•ˆì°© ë° ì‹ ì¸ ê·¸ë£¹ ì„±ê³µì  ë°ë·”. ìœ„ë²„ìŠ¤ í”Œë«í¼ ìˆ˜ìµ ëª¨ë¸ ë‹¤ê°í™”. ê²Œì„, AI ë“± ì‹ ê·œ ì‚¬ì—… í™•ì¥.",
        "ì˜¤ë¦¬ì˜¨": "ê²¬ê³ í•œ êµ­ë‚´ ë° í•´ì™¸(ì¤‘êµ­, ë² íŠ¸ë‚¨, ëŸ¬ì‹œì•„) ì‹¤ì . ì œí’ˆ ì¹´í…Œê³ ë¦¬ í™•ì¥(ê°„í¸ëŒ€ìš©ì‹ ë“±) ë° ì‹ ê·œ ì‹œì¥ ì§„ì¶œ ëª¨ìƒ‰. ë°”ì´ì˜¤ ì‚¬ì—… íˆ¬ì.",
        "ë†ì‹¬": "êµ­ë‚´ì™¸ ë¼ë©´ ì‹œì¥ ì§€ë°°ë ¥. í•´ì™¸ ë²•ì¸ ê³ ì„±ì¥ ì§€ì†. ë¹„ìš© ìƒìŠ¹ ë¶€ë‹´ ì™„í™” ë° íŒê°€ ì¸ìƒ íš¨ê³¼. ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ë“± ì‹ ì‚¬ì—… ì¶”ì§„.",
    }
}

# --- ìˆ˜ì¤€ë³„ ìš©ì–´ ì‚¬ì „ ---
GLOSSARY = {
    "ì´ˆë“±": {
        "ì£¼ì‹": "íšŒì‚¬ì˜ ì‘ì€ ì¡°ê°. ì´ê±¸ ì‚¬ë©´ ë‚˜ë„ íšŒì‚¬ ì£¼ì¸!",
        "ì£¼ê°€": "ì£¼ì‹ 1ê°œì˜ ê°€ê²©. ì‚¬ê³  ì‹¶ì€ ì‚¬ëŒì´ ë§ìœ¼ë©´ ì˜¤ë¥´ê³ , íŒ”ê³  ì‹¶ì€ ì‚¬ëŒì´ ë§ìœ¼ë©´ ë‚´ë ¤.",
        "ë§¤ìˆ˜": "ì£¼ì‹ì„ ì‚¬ëŠ” ê²ƒ. 'ë‚˜ ì´ íšŒì‚¬ ì£¼ì‹ ì‚´ë˜!'",
        "ë§¤ë„": "ì£¼ì‹ì„ íŒŒëŠ” ê²ƒ. 'ë‚˜ ì´ ì£¼ì‹ íŒ”ì•„ì„œ ëˆìœ¼ë¡œ ë°”ê¿€ë˜!'",
        "í¬íŠ¸í´ë¦¬ì˜¤": "ë‚´ê°€ ê°€ì§„ ì£¼ì‹ê³¼ í˜„ê¸ˆ ê¾¸ëŸ¬ë¯¸. ì–´ë–¤ ì£¼ì‹ì„ ì–¼ë§ˆë‚˜ ê°€ì¡ŒëŠ”ì§€ ë³´ì—¬ì¤˜.",
        "ìˆ˜ìµë¥ ": "ë‚´ê°€ íˆ¬ìí•œ ëˆì´ ì–¼ë§ˆë‚˜ ëŠ˜ì—ˆëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ìˆ«ì. (%)",
        "ìƒìŠ¹": "ì£¼ê°€ê°€ ì˜¤ë¥´ëŠ” ê²ƒ. ê¸°ë¶„ ì¢‹ì•„!",
        "í•˜ë½": "ì£¼ê°€ê°€ ë‚´ë¦¬ëŠ” ê²ƒ. ì¡°ê¸ˆ ìŠ¬í¼.",
        "ë³€ë™": "ì£¼ê°€ê°€ ì˜¤ë¥´ë½ë‚´ë¦¬ë½ ì¶¤ì¶”ëŠ” ê²ƒ.",
        "íˆ¬ì": "ëˆì„ ë¶ˆë¦¬ê¸° ìœ„í•´ ì£¼ì‹ ê°™ì€ ê³³ì— ëˆì„ ë„£ëŠ” ê²ƒ.",
        "ì„¹í„°": "ë¹„ìŠ·í•œ ì¼ì„ í•˜ëŠ” íšŒì‚¬ë“¤ ëª¨ì„. (ì˜ˆ: ìë™ì°¨ íšŒì‚¬ ëª¨ì„, ê³¼ì íšŒì‚¬ ëª¨ì„)",
        "ì „ì¼ ëŒ€ë¹„": "ì–´ì œë‘ ë¹„êµí•´ì„œ ì£¼ê°€ê°€ ì–¼ë§ˆë‚˜ ë³€í–ˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ê²ƒ.",
        "ë‰´ìŠ¤": "ì„¸ìƒ ì†Œì‹. íšŒì‚¬ì— ì¢‹ì€ ì†Œì‹ë„ ìˆê³ , ë‚˜ìœ ì†Œì‹ë„ ìˆì–´.",
        "í˜„ê¸ˆ": "ë‚´ê°€ ì§€ê¸ˆ ë°”ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ëˆ.",
        "í‰ê°€ì•¡": "ë‚´ê°€ ê°€ì§„ ì£¼ì‹ë“¤ì„ ì§€ê¸ˆ ê°€ê²©ìœ¼ë¡œ ê³„ì‚°í•˜ë©´ ì–¼ë§ˆì¸ì§€ ì•Œë ¤ì£¼ëŠ” ê²ƒ.",
        "ì†ìµ": "ë‚´ê°€ ëˆì„ ë²Œì—ˆëŠ”ì§€(ì´ìµ), ìƒì—ˆëŠ”ì§€(ì†í•´) ì•Œë ¤ì£¼ëŠ” ê²ƒ.",
    },
    "ì¤‘ë“±": {
        "ì£¼ì‹": "ê¸°ì—…ì´ ìê¸ˆì„ ëª¨ìœ¼ê¸° ìœ„í•´ ë°œí–‰í•˜ëŠ” ì†Œìœ ê¶Œ ì¦ì„œ. ì£¼ì£¼ëŠ” íšŒì‚¬ì˜ ì¼ë¶€ë¥¼ ì†Œìœ .",
        "ì£¼ê°€": "ì‹œì¥ì—ì„œ ê±°ë˜ë˜ëŠ” ì£¼ì‹ 1ì£¼ë‹¹ ê°€ê²©. ìˆ˜ìš”ì™€ ê³µê¸‰ì— ë”°ë¼ ê²°ì •ë¨.",
        "ë§¤ìˆ˜": "ì£¼ì‹ì„ ì‚¬ëŠ” í–‰ìœ„. ê°€ê²© ìƒìŠ¹ì„ ê¸°ëŒ€í•˜ê³  êµ¬ë§¤.",
        "ë§¤ë„": "ë³´ìœ í•œ ì£¼ì‹ì„ íŒŒëŠ” í–‰ìœ„. ì´ìµ ì‹¤í˜„ ë˜ëŠ” ì†ì‹¤ í™•ì • ëª©ì .",
        "í¬íŠ¸í´ë¦¬ì˜¤": "íˆ¬ììê°€ ë³´ìœ í•œ ë‹¤ì–‘í•œ ìì‚°(ì£¼ì‹, ì±„ê¶Œ, í˜„ê¸ˆ ë“±)ì˜ êµ¬ì„±.",
        "ìˆ˜ìµë¥ ": "íˆ¬ì ì›ê¸ˆ ëŒ€ë¹„ ë°œìƒí•œ ì´ìµì˜ ë¹„ìœ¨. (ì´ í‰ê°€ì•¡ - ì´ íˆ¬ìê¸ˆ) / ì´ íˆ¬ìê¸ˆ * 100%",
        "ìƒìŠ¹": "ì£¼ê°€ê°€ ì´ì „ ê°€ê²©ë³´ë‹¤ ì˜¤ë¥´ëŠ” í˜„ìƒ.",
        "í•˜ë½": "ì£¼ê°€ê°€ ì´ì „ ê°€ê²©ë³´ë‹¤ ë‚´ë¦¬ëŠ” í˜„ìƒ.",
        "ë³€ë™ì„±": "ì£¼ê°€ë‚˜ ì‹œì¥ ì§€ìˆ˜ê°€ ì›€ì§ì´ëŠ” ì •ë„. ë³€ë™ì„±ì´ í¬ë©´ ê°€ê²© ë³€í™”ê°€ ì‹¬í•¨.",
        "íˆ¬ì": "ë¯¸ë˜ì˜ ìˆ˜ìµì„ ê¸°ëŒ€í•˜ê³  í˜„ì¬ì˜ ìê¸ˆì„ íˆ¬ì…í•˜ëŠ” í–‰ìœ„.",
        "ì„¹í„°": "ì‚°ì—… ë¶„ë¥˜. ë¹„ìŠ·í•œ ì‚¬ì—…ì„ ì˜ìœ„í•˜ëŠ” ê¸°ì—…ë“¤ì˜ ê·¸ë£¹ (ì˜ˆ: IT ì„¹í„°, ë°”ì´ì˜¤ ì„¹í„°).",
        "ì „ì¼ ëŒ€ë¹„ ë“±ë½ë¥ ": "ì˜¤ëŠ˜ ì¢…ê°€ê°€ ì–´ì œ ì¢…ê°€ì— ë¹„í•´ ì–¼ë§ˆë‚˜ ë³€ë™í–ˆëŠ”ì§€ ë°±ë¶„ìœ¨ë¡œ í‘œì‹œ.",
        "ë‰´ìŠ¤ (ê²½ì œ)": "ê¸°ì—… ì‹¤ì , ê²½ì œ ì§€í‘œ ë°œí‘œ, ì •ì±… ë³€í™” ë“± ì£¼ê°€ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆëŠ” ì •ë³´.",
        "í˜„ê¸ˆ": "ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ìê¸ˆ. í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ ìœ ë™ì„± ìì‚°.",
        "í‰ê°€ì•¡ (ì£¼ì‹)": "ë³´ìœ  ì£¼ì‹ ìˆ˜ëŸ‰ Ã— í˜„ì¬ ì£¼ê°€. í¬íŠ¸í´ë¦¬ì˜¤ì˜ í˜„ì¬ ê°€ì¹˜.",
        "ì†ìµ": "ë§¤ìˆ˜ ê°€ê²©ê³¼ í˜„ì¬(ë˜ëŠ” ë§¤ë„) ê°€ê²©ì˜ ì°¨ì´ë¡œ ë°œìƒí•˜ëŠ” ì´ìµ ë˜ëŠ” ì†ì‹¤.",
        "ì‹œê°€ì´ì•¡": "ê¸°ì—…ì˜ ì „ì²´ ì£¼ì‹ ê°€ì¹˜. ì£¼ê°€ Ã— ì´ ë°œí–‰ ì£¼ì‹ ìˆ˜.",
        "ë°°ë‹¹ê¸ˆ": "ê¸°ì—…ì´ ì´ìµì˜ ì¼ë¶€ë¥¼ ì£¼ì£¼ì—ê²Œ ë‚˜ëˆ ì£¼ëŠ” ëˆ.",
    },
    "ê³ ë“±": {
        "ì£¼ì‹ (ë³´í†µì£¼)": "ê¸°ì—…ì˜ ì†Œìœ ê¶Œì„ ë‚˜íƒ€ë‚´ëŠ” ëŒ€í‘œì ì¸ ìœ ê°€ì¦ê¶Œ. ì˜ê²°ê¶Œê³¼ ë°°ë‹¹ê¶Œ ë³´ìœ .",
        "ì£¼ê°€": "ìë³¸ì‹œì¥ì—ì„œ ê²°ì •ë˜ëŠ” ì£¼ì‹ì˜ ì‹œì¥ ê°€ê²©. ê¸°ì—… ê°€ì¹˜, ì—…í™©, ê²½ì œ ìƒí™© ë“± ë³µí•©ì  ìš”ì¸ ë°˜ì˜.",
        "ë§¤ìˆ˜ (Long Position)": "ê°€ê²© ìƒìŠ¹ì„ ì˜ˆìƒí•˜ê³  íŠ¹ì • ìì‚°ì„ ë§¤ì…í•˜ëŠ” ê²ƒ.",
        "ë§¤ë„ (Short Selling / Position Closing)": "ë³´ìœ  ìì‚°ì„ íŒ”ê±°ë‚˜(ì²­ì‚°), ê°€ê²© í•˜ë½ì„ ì˜ˆìƒí•˜ê³  ë¹Œë ¤ì„œ íŒŒëŠ” ê²ƒ(ê³µë§¤ë„).",
        "í¬íŠ¸í´ë¦¬ì˜¤": "ìœ„í—˜ ë¶„ì‚° ë° ìˆ˜ìµ ê·¹ëŒ€í™”ë¥¼ ìœ„í•´ ì—¬ëŸ¬ ìì‚°ì— ë¶„ì‚° íˆ¬ìí•œ ì§‘í•©.",
        "ìˆ˜ìµë¥  (CAGR, ëˆ„ì )": "íˆ¬ìê¸°ê°„ ë™ì•ˆì˜ ì—°í‰ê·  ë³µí•© ìˆ˜ìµë¥  ë˜ëŠ” ì´ ëˆ„ì  ìˆ˜ìµë¥ .",
        "ìƒìŠ¹ (Bull Market)": "ì£¼ì‹ ì‹œì¥ì´ ì „ë°˜ì ìœ¼ë¡œ ì¥ê¸°ê°„ ìƒìŠ¹í•˜ëŠ” ì¶”ì„¸.",
        "í•˜ë½ (Bear Market)": "ì£¼ì‹ ì‹œì¥ì´ ì „ë°˜ì ìœ¼ë¡œ ì¥ê¸°ê°„ í•˜ë½í•˜ëŠ” ì¶”ì„¸.",
        "ë³€ë™ì„± (Volatility)": "ìì‚° ê°€ê²©ì˜ ë³€ë™ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í†µê³„ì  ì§€í‘œ. í‘œì¤€í¸ì°¨ ë“±ìœ¼ë¡œ ì¸¡ì •.",
        "íˆ¬ì (Investment)": "ìë³¸ì„ íˆ¬ì…í•˜ì—¬ ë¯¸ë˜ì˜ ìë³¸ ì´ë“ì´ë‚˜ ì†Œë“ ì¦ëŒ€ë¥¼ ì¶”êµ¬í•˜ëŠ” í–‰ìœ„.",
        "ì„¹í„°/ì‚°ì—…": "ê²½ì œ í™œë™ ì˜ì—­ì— ë”°ë¥¸ ê¸°ì—… ë¶„ë¥˜ (GICS, KRX ì‚°ì—…ë¶„ë¥˜ ë“±). ê²½ê¸° ìˆœí™˜ê³¼ì˜ ì—°ê´€ì„± ë¶„ì„.",
        "ì „ì¼ ëŒ€ë¹„ ë“±ë½ë¥ ": "ê¸°ì¤€ ì‹œì (ì£¼ë¡œ ì „ì¼ ì¢…ê°€) ëŒ€ë¹„ ê°€ê²© ë³€í™”ìœ¨. ì‹œì¥ ëª¨ë©˜í…€ íŒŒì•… ì§€í‘œ.",
        "ë‰´ìŠ¤ (ê±°ì‹œ/ë¯¸ì‹œ)": "ê¸ˆë¦¬, í™˜ìœ¨, GDP ë“± ê±°ì‹œê²½ì œ ì§€í‘œ ë° ê°œë³„ ê¸°ì—… ë‰´ìŠ¤(ì‹¤ì , M&A, ì‹ ê¸°ìˆ  ë“±).",
        "í˜„ê¸ˆ (Cash Equivalents)": "í˜„ê¸ˆ ë° ë‹¨ê¸° ê¸ˆìœµìƒí’ˆ. í¬íŠ¸í´ë¦¬ì˜¤ì˜ ì•ˆì •ì„± ë° ê¸°íšŒ í™•ë³´ ìˆ˜ë‹¨.",
        "í‰ê°€ì•¡ (Mark-to-Market)": "ë³´ìœ  ìì‚°ì„ í˜„ì¬ ì‹œì¥ ê°€ê²©ìœ¼ë¡œ í‰ê°€í•œ ê¸ˆì•¡.",
        "ì†ìµ (ì‹¤í˜„/ë¯¸ì‹¤í˜„)": "ë§¤ë§¤ë¥¼ í†µí•´ í™•ì •ëœ ì†ìµ(ì‹¤í˜„)ê³¼ í‰ê°€ìƒì˜ ì†ìµ(ë¯¸ì‹¤í˜„).",
        "ì‹œê°€ì´ì•¡ (Market Capitalization)": "ê¸°ì—…ì˜ ê·œëª¨ì™€ ì‹œì¥ ê°€ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ.",
        "ë°°ë‹¹ìˆ˜ìµë¥ ": "ì£¼ê°€ ëŒ€ë¹„ ë°°ë‹¹ê¸ˆì˜ ë¹„ìœ¨. íˆ¬ì ë§¤ë ¥ë„ íŒë‹¨ ì§€í‘œ ì¤‘ í•˜ë‚˜.",
        "PER (ì£¼ê°€ìˆ˜ìµë¹„ìœ¨)": "ì£¼ê°€ / ì£¼ë‹¹ìˆœì´ìµ(EPS). ê¸°ì—…ì˜ ìˆ˜ìµì„± ëŒ€ë¹„ ì£¼ê°€ ìˆ˜ì¤€ í‰ê°€.",
        "PBR (ì£¼ê°€ìˆœìì‚°ë¹„ìœ¨)": "ì£¼ê°€ / ì£¼ë‹¹ìˆœìì‚°(BPS). ê¸°ì—…ì˜ ìì‚°ê°€ì¹˜ ëŒ€ë¹„ ì£¼ê°€ ìˆ˜ì¤€ í‰ê°€.",
        "ROE (ìê¸°ìë³¸ì´ìµë¥ )": "ë‹¹ê¸°ìˆœì´ìµ / ìê¸°ìë³¸. ê¸°ì—…ì˜ ìˆ˜ìµì„± ë° íš¨ìœ¨ì„± ì§€í‘œ.",
    }
}

# --- ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ---
def initialize_session_state(selected_level):
    level_info = LEVELS[selected_level]
    initial_cash = level_info["initial_cash"]

    # í¬íŠ¸í´ë¦¬ì˜¤ ì´ˆê¸°í™” (ê¸°ì¡´ ë°ì´í„° ì—†ê±°ë‚˜ ë¦¬ì…‹ í•„ìš” ì‹œ)
    if "portfolio" not in st.session_state or st.session_state.get("force_reset"):
        st.session_state["portfolio"] = {"cash": initial_cash, "stocks": {}}
        st.session_state["initial_cash_set"] = initial_cash # ì´ˆê¸° ìë³¸ê¸ˆ ê¸°ë¡
        if "force_reset" in st.session_state:
            del st.session_state["force_reset"] # ë¦¬ì…‹ í”Œë˜ê·¸ ì œê±°

    # ì£¼ì‹ ì •ë³´ ì´ˆê¸°í™” (ê¸°ì¡´ ë°ì´í„° ì—†ê±°ë‚˜ ë¦¬ì…‹ í•„ìš” ì‹œ)
    if "stocks" not in st.session_state or not st.session_state["stocks"]: # stocksê°€ ë¹„ì–´ìˆì„ ë•Œë„ ì´ˆê¸°í™”
        st.session_state["stocks"] = {}
        base_stocks_data = { # ê¸°ë³¸ êµ¬ì¡°ë§Œ ì •ì˜
            "ê¸°ìˆ (Tech)": ["ì‚¼ì„±ì „ì", "SKí•˜ì´ë‹‰ìŠ¤", "LGë””ìŠ¤í”Œë ˆì´"],
            "ìë™ì°¨(Auto)": ["í˜„ëŒ€ìë™ì°¨", "ê¸°ì•„", "í˜„ëŒ€ëª¨ë¹„ìŠ¤"],
            "ì—ë„ˆì§€(Energy)": ["LGì—ë„ˆì§€ì†”ë£¨ì…˜", "SKì´ë…¸ë² ì´ì…˜", "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°"],
            "ì¸í„°ë„·(Internet)": ["ë„¤ì´ë²„", "ì¹´ì¹´ì˜¤", "ì¹´ì¹´ì˜¤ë±…í¬"],
            "ì†Œë¹„ì¬(Consumer Goods)": ["CJì œì¼ì œë‹¹", "ì•„ëª¨ë ˆí¼ì‹œí”½", "LGìƒí™œê±´ê°•"],
            "ê¸ˆìœµ(Finance)": ["KBê¸ˆìœµ", "ì‹ í•œì§€ì£¼", "í•˜ë‚˜ê¸ˆìœµì§€ì£¼"],
            "ê±´ì„¤(Construction)": ["ì‚¼ì„±ë¬¼ì‚°", "HDí˜„ëŒ€", "GSê±´ì„¤"],
            "ìœ í†µ(Retail)": ["ë¡¯ë°ì‡¼í•‘", "ì´ë§ˆíŠ¸"],
            "í†µì‹ (Telecom)": ["KT", "SKí…”ë ˆì½¤"],
            "ì œì•½/ë°”ì´ì˜¤(Pharma/Bio)": ["ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤", "ì…€íŠ¸ë¦¬ì˜¨"],
            "í™”í•™(Chemical)": ["LGí™”í•™", "ê¸ˆí˜¸ì„ìœ í™”í•™"],
            "ì² ê°•(Steel)": ["POSCOí™€ë”©ìŠ¤", "í˜„ëŒ€ì œì² "],
            "ìš´ì†¡(Transportation)": ["ëŒ€í•œí•­ê³µ", "HMM"],
            "ì—”í„°í…Œì¸ë¨¼íŠ¸(Entertainment)": ["CJ ENM", "í•˜ì´ë¸Œ"],
            "ì‹í’ˆ(Food)": ["ì˜¤ë¦¬ì˜¨", "ë†ì‹¬"],
        }
        # ê° ìˆ˜ì¤€ë³„ ì„¤ëª… ë§¤í•‘ ë° ì´ˆê¸° ê°€ê²© ì„¤ì •
        for sector, stock_list in base_stocks_data.items():
            st.session_state["stocks"][sector] = {}
            for stock_name in stock_list:
                # ì´ˆê¸° ê°€ê²© ëœë¤ ì„¤ì • (ê¸°ì¡´ ë¡œì§ ìœ ì§€, ì•½ê°„ì˜ ì¡°ì • ê°€ëŠ¥)
                if stock_name in ["ì‚¼ì„±ì „ì", "SKí•˜ì´ë‹‰ìŠ¤", "ê¸°ì•„", "KBê¸ˆìœµ", "ì‹ í•œì§€ì£¼", "HDí˜„ëŒ€", "GSê±´ì„¤", "KT", "SKí…”ë ˆì½¤", "í˜„ëŒ€ì œì² ", "ëŒ€í•œí•­ê³µ", "HMM", "ì¹´ì¹´ì˜¤", "ì¹´ì¹´ì˜¤ë±…í¬"]:
                    price = random.randint(30000, 90000) # ë²”ìœ„ ì•½ê°„ ì¡°ì •
                elif stock_name in ["LGë””ìŠ¤í”Œë ˆì´", "ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°", "í•˜ë‚˜ê¸ˆìœµì§€ì£¼"]:
                     price = random.randint(15000, 45000)
                elif stock_name in ["í˜„ëŒ€ìë™ì°¨", "í˜„ëŒ€ëª¨ë¹„ìŠ¤", "SKì´ë…¸ë² ì´ì…˜", "ë„¤ì´ë²„", "ì•„ëª¨ë ˆí¼ì‹œí”½", "ì‚¼ì„±ë¬¼ì‚°", "ë¡¯ë°ì‡¼í•‘", "ì´ë§ˆíŠ¸", "ì…€íŠ¸ë¦¬ì˜¨", "ê¸ˆí˜¸ì„ìœ í™”í•™", "CJ ENM", "í•˜ì´ë¸Œ", "ì˜¤ë¦¬ì˜¨"]:
                     price = random.randint(120000, 280000)
                elif stock_name in ["LGì—ë„ˆì§€ì†”ë£¨ì…˜", "CJì œì¼ì œë‹¹", "POSCOí™€ë”©ìŠ¤", "ë†ì‹¬"]:
                     price = random.randint(280000, 450000)
                elif stock_name in ["LGìƒí™œê±´ê°•", "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤", "LGí™”í•™"]:
                     price = random.randint(500000, 800000)
                else:
                     price = random.randint(50000, 150000) # ê¸°ë³¸ê°’

                st.session_state["stocks"][sector][stock_name] = {
                    "current_price": price,
                    "price_history": [price], # ì´ˆê¸° ê°€ê²© ê¸°ë¡
                    "description_ì´ˆë“±": STOCK_DESCRIPTIONS["ì´ˆë“±"].get(stock_name, "ì„¤ëª… ì—†ìŒ"),
                    "description_ì¤‘ë“±": STOCK_DESCRIPTIONS["ì¤‘ë“±"].get(stock_name, "ì„¤ëª… ì—†ìŒ"),
                    "description_ê³ ë“±": STOCK_DESCRIPTIONS["ê³ ë“±"].get(stock_name, "ì„¤ëª… ì—†ìŒ"),
                }

    # ë‚˜ë¨¸ì§€ ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” (ê¸°ì¡´ ë¡œì§ ìœ ì§€, í•„ìš”ì‹œ ì¶”ê°€)
    if "chat_session" not in st.session_state: st.session_state["chat_session"] = []
    if "news_analysis_results" not in st.session_state: st.session_state["news_analysis_results"] = {}
    if "messages" not in st.session_state: st.session_state["messages"] = []
    if "daily_news" not in st.session_state: st.session_state["daily_news"] = None
    if "previous_daily_news" not in st.session_state: st.session_state["previous_daily_news"] = None
    # if "news_date" not in st.session_state: st.session_state["news_date"] = None # ë‚ ì§œ ì‚¬ìš© ì•ˆ í•¨
    if "news_meanings" not in st.session_state: st.session_state["news_meanings"] = {}
    # if "ai_news_analysis_output" not in st.session_state: st.session_state["ai_news_analysis_output"] = {} # ì‚¬ìš© ì•ˆ í•¨
    if "day_count" not in st.session_state: st.session_state["day_count"] = 1
    if "sector_news_impact" not in st.session_state: st.session_state["sector_news_impact"] = {}
    if 'buy_confirm' not in st.session_state: st.session_state['buy_confirm'] = False
    if 'sell_confirm' not in st.session_state: st.session_state['sell_confirm'] = False
    if 'user_id' not in st.session_state: st.session_state['user_id'] = None
    if 'user_settings' not in st.session_state: st.session_state['user_settings'] = None
    if 'selected_level' not in st.session_state: st.session_state['selected_level'] = "ì´ˆë“±" # ê¸°ë³¸ê°’

# --- ë‰´ìŠ¤ ìƒì„± í•¨ìˆ˜ (ìˆ˜ì¤€ë³„) ---
def generate_news():
    selected_level = st.session_state.get('selected_level', 'ì´ˆë“±')
    level_info = LEVELS[selected_level]
    grade_level_text = level_info['grade_level']

    if selected_level == 'ì´ˆë“±':
        level_instruction = f"{grade_level_text} ìˆ˜ì¤€ì— ë§ì¶° ì•„ì£¼ ì‰½ê³  êµ¬ì²´ì ì¸ ì˜ˆì‹œ(ì˜ˆ: ì¥ë‚œê°, ê³¼ì, ê²Œì„)ë¥¼ ë“¤ì–´ ì„¤ëª…í•´ì£¼ì„¸ìš”. ì–´ë ¤ìš´ ê²½ì œ ìš©ì–´(ì˜ˆ: ê¸ˆë¦¬, í™˜ìœ¨, ì¸í”Œë ˆì´ì…˜)ëŠ” ìµœëŒ€í•œ í”¼í•˜ê³ , ì¼ìƒ ìƒí™œê³¼ ê´€ë ¨ëœ ë‚´ìš©ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”."
        sentence_count = "8~10ë¬¸ì¥"
    elif selected_level == 'ì¤‘ë“±':
        level_instruction = f"{grade_level_text} ìˆ˜ì¤€ì— ë§ì¶° ì‘ì„±í•´ì£¼ì„¸ìš”. ê¸°ë³¸ì ì¸ ê²½ì œ ê°œë…(ì˜ˆ: ìˆ˜ìš”ì™€ ê³µê¸‰, ê²½ìŸ, ì¸ê¸° ìƒí’ˆ)ì„ í¬í•¨í•´ë„ ì¢‹ìŠµë‹ˆë‹¤. ë„ˆë¬´ ì „ë¬¸ì ì´ì§€ ì•Šê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”."
        sentence_count = "10~12ë¬¸ì¥"
    else: # ê³ ë“±
        level_instruction = f"{grade_level_text} ìˆ˜ì¤€ì— ë§ì¶° ì‘ì„±í•´ì£¼ì„¸ìš”. ê²½ì œ ì§€í‘œ(ì˜ˆ: ì„±ì¥ë¥ , ì‹¤ì—…ë¥ ), êµ­ì œ ê´€ê³„, ê¸°ìˆ  íŠ¸ë Œë“œ, ê¸ˆë¦¬ ë³€ë™ ë“± ì¢€ ë” ì‹¬ë„ ìˆëŠ” ë‚´ìš©ì„ ë‹¤ë£¨ì–´ë„ ì¢‹ìŠµë‹ˆë‹¤. ë¶„ì„ì ì¸ ì‹œê°ì„ í¬í•¨í•´ì£¼ì„¸ìš”."
        sentence_count = "12~15ë¬¸ì¥"

    prompt = f"""
ì§€ì‹œ:
{level_instruction}
ì£¼ì‹ ì‹œì¥ê³¼ ê²½ì œì— ê´€ë ¨ëœ ë‰´ìŠ¤ ê¸°ì‚¬ 5ê°œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.
ê° ê¸°ì‚¬ëŠ” {sentence_count} ì •ë„ë¡œ ìì„¸í•˜ê²Œ ì‘ì„±í•˜ê³ , íŠ¹ì • íšŒì‚¬ ì´ë¦„ì´ë‚˜ ì£¼ì‹ ì¢…ëª©ì„ ì§ì ‘ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”.
í•™ìƒë“¤ì´ ë‰´ìŠ¤ë¥¼ ì½ê³  ì–´ë–¤ ì¢…ë¥˜ì˜ íšŒì‚¬ê°€ ìœ ë§í• ì§€ ë˜ëŠ” ì–´ë ¤ì›€ì„ ê²ªì„ì§€ ìŠ¤ìŠ¤ë¡œ ì¶”ë¡ í•  ìˆ˜ ìˆë„ë¡, ì¼ë°˜ì ì¸ ê²½ì œ ìƒí™©ì´ë‚˜ íŠ¹ì • ì‚°ì—…(ì˜ˆ: IT, ìë™ì°¨, ê²Œì„, ì‹í’ˆ, ì—ë„ˆì§€ ë“±) ë™í–¥ì— ëŒ€í•œ ë‰´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.
ê¸ì •ì ì¸ ë‰´ìŠ¤, ë¶€ì •ì ì¸ ë‰´ìŠ¤, ì¤‘ë¦½ì ì¸ ë‰´ìŠ¤ë¥¼ ë‹¤ì–‘í•˜ê²Œ í¬í•¨í•˜ë˜, 'ê¸ì •ì /ë¶€ì •ì /ì¤‘ë¦½ì 'ì´ë¼ëŠ” ë‹¨ì–´ëŠ” ë‰´ìŠ¤ ë³¸ë¬¸ì— ì“°ì§€ ë§ˆì„¸ìš”.
ë‰´ìŠ¤ ë‚´ìš©ì— ë”°ë¼ ê´€ë ¨ ì£¼ì‹ë“¤ì˜ ê°€ê²©ì´ ì˜¤ë¥´ê±°ë‚˜ ë‚´ë¦´ ìˆ˜ ìˆëŠ” ë‹¨ì„œë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”.
ê° ë‰´ìŠ¤ ê¸°ì‚¬ëŠ” "## ë‰´ìŠ¤ [ë²ˆí˜¸]" ë¡œ ì‹œì‘í•´ì£¼ì„¸ìš”. (ì˜ˆ: ## ë‰´ìŠ¤ 1, ## ë‰´ìŠ¤ 2 ...)

**ìƒì„±ëœ ë‰´ìŠ¤ ê¸°ì‚¬:**
"""
    messages = [{"role": "user", "content": prompt}]

    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini", # ë˜ëŠ” gpt-4o
            messages=messages,
            temperature=0.7,
            max_tokens=1500, # í† í° ìˆ˜ ì¡°ì • ê°€ëŠ¥
            top_p=0.95,
            frequency_penalty=0,
            presence_penalty=0
        )
        news_text = response.choices[0].message.content.strip()

        news_articles = []
        if news_text:
            # "## ë‰´ìŠ¤ " ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ê³ , ë¹ˆ ë¬¸ìì—´ ì œê±°
            raw_articles = news_text.split("## ë‰´ìŠ¤ ")
            for article in raw_articles:
                if article.strip():
                    # ë‰´ìŠ¤ ë²ˆí˜¸ ì œê±° ë° ê³µë°± ì œê±°
                    content = article.split('\n', 1)[-1].strip() if '\n' in article else article.strip()
                    if content: # ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€
                         # ë‰´ìŠ¤ ë²ˆí˜¸ ë¶€ë¶„ ì œê±° (ì˜ˆ: "1\në‰´ìŠ¤ ë‚´ìš©..." -> "ë‰´ìŠ¤ ë‚´ìš©...")
                        if content and content[0].isdigit() and content[1:3] in ['\n', '. ']:
                             content = content.split('\n', 1)[-1].strip()
                        news_articles.append(content)

        # ì •í™•íˆ 5ê°œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° ì²˜ë¦¬ (ì˜ˆ: ë¶€ì¡±í•˜ë©´ ë¹ˆ ë¬¸ìì—´ ì¶”ê°€, ë§ìœ¼ë©´ ìë¥´ê¸°)
        if len(news_articles) < 5:
            news_articles.extend(["(ë‰´ìŠ¤ ìƒì„± ì‹¤íŒ¨)"] * (5 - len(news_articles)))
        return news_articles[:5]

    except Exception as e:
        st.error(f"ë‰´ìŠ¤ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return ["(ë‰´ìŠ¤ ìƒì„± ì˜¤ë¥˜)"] * 5


# --- ë‰´ìŠ¤ í•´ì„¤ í•¨ìˆ˜ (ìˆ˜ì¤€ë³„) ---
def explain_daily_news_meanings(daily_news):
    if daily_news is None:
        return {}

    selected_level = st.session_state.get('selected_level', 'ì´ˆë“±')
    level_info = LEVELS[selected_level]
    grade_level_text = level_info['grade_level']

    if selected_level == 'ì´ˆë“±':
        level_instruction = f"{grade_level_text}ì´ ì´í•´í•˜ê¸° ì‰½ê²Œ ì•„ì£¼ ì‰¬ìš´ ë‹¨ì–´ë¡œ 2~3ë¬¸ì¥ ì´ë‚´ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”. ë¹„ìœ ë‚˜ ì‰¬ìš´ ì˜ˆì‹œë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤."
    elif selected_level == 'ì¤‘ë“±':
        level_instruction = f"{grade_level_text}ì´ ì´í•´í•˜ê¸° ì‰½ê²Œ í•µì‹¬ ë‚´ìš©ì„ 3ë¬¸ì¥ ì •ë„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”. ê´€ë ¨ ê²½ì œ ìš©ì–´ê°€ ìˆë‹¤ë©´ ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”."
    else: # ê³ ë“±
        level_instruction = f"{grade_level_text}ì´ ì´í•´í•  ìˆ˜ ìˆë„ë¡ í•µì‹¬ ë‚´ìš©ê³¼ ì´ ë‰´ìŠ¤ê°€ ê²½ì œë‚˜ íŠ¹ì • ì‚°ì—…ì— ë¯¸ì¹  ìˆ˜ ìˆëŠ” ì ì¬ì  ì˜í–¥ì„ 3-4ë¬¸ì¥ ì •ë„ë¡œ ë¶„ì„ì ìœ¼ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”."

    meanings = {}
    valid_sectors_list = list(st.session_state["stocks"].keys()) # ë¯¸ë¦¬ ëª©ë¡ ìƒì„±

    for i, news_article in enumerate(daily_news):
        if "(ë‰´ìŠ¤ ìƒì„± ì˜¤ë¥˜)" in news_article or "(ë‰´ìŠ¤ ìƒì„± ì‹¤íŒ¨)" in news_article:
             meanings[str(i + 1)] = {"explanation": "ë‰´ìŠ¤ ìƒì„±ì— ì‹¤íŒ¨í•˜ì—¬ í•´ì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "sectors": []}
             continue

        prompt = f"""
**ì‹ ë¬¸ ê¸°ì‚¬:**
{news_article}

**ì§€ì‹œ:**
ìœ„ ì‹ ë¬¸ ê¸°ì‚¬ì˜ í•µì‹¬ ì˜ë¯¸ë¥¼ {level_instruction} "í•´ì„¤: " ë‹¤ìŒì— ì„¤ëª…í•´ì£¼ì„¸ìš”.
ê·¸ë¦¬ê³  ì´ ë‰´ìŠ¤ì™€ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì£¼ì‹ ì„¹í„° 1~2ê°œë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•´ì„œ "ê´€ë ¨ ì„¹í„°: " ë‹¤ìŒì— ì•Œë ¤ì£¼ì„¸ìš”. ì œì‹œëœ ì„¹í„° ëª©ë¡ [{', '.join(valid_sectors_list)}] ì¤‘ì—ì„œë§Œ ì„ íƒí•˜ê³ , ê´€ë ¨ ì„¹í„°ê°€ ëª…í™•í•˜ì§€ ì•Šê±°ë‚˜ ì—†ë‹¤ë©´ "ê´€ë ¨ ì„¹í„°: ì—†ìŒ" ì´ë¼ê³  í•´ì£¼ì„¸ìš”.

ë‰´ìŠ¤ ì˜ë¯¸ í•´ì„¤:
"""
        messages = [{"role": "user", "content": prompt}]
        try:
            response = client.chat.completions.create(
                model="gpt-4o-mini", # ë˜ëŠ” gpt-4o
                messages=messages,
                temperature=0.5,
                max_tokens=300,
                top_p=0.95,
                frequency_penalty=0,
                presence_penalty=0
            )
            meaning_text = response.choices[0].message.content.strip()

            explanation = ""
            related_sectors = []

            # "í•´ì„¤:" ë¶€ë¶„ ì¶”ì¶œ
            if "í•´ì„¤:" in meaning_text:
                explanation_start_index = meaning_text.find("í•´ì„¤:") + len("í•´ì„¤:")
                # "ê´€ë ¨ ì„¹í„°:" ì•ê¹Œì§€ ë˜ëŠ” ë¬¸ìì—´ ëê¹Œì§€ ì¶”ì¶œ
                explanation_end_index = meaning_text.find("ê´€ë ¨ ì„¹í„°:")
                if explanation_end_index != -1:
                    explanation = meaning_text[explanation_start_index:explanation_end_index].strip()
                else:
                    explanation = meaning_text[explanation_start_index:].strip()
            else:
                explanation = "AI í•´ì„¤ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." # í•´ì„¤ íƒœê·¸ê°€ ì—†ëŠ” ê²½ìš°

            # "ê´€ë ¨ ì„¹í„°:" ë¶€ë¶„ ì¶”ì¶œ
            if "ê´€ë ¨ ì„¹í„°:" in meaning_text:
                related_sectors_str = meaning_text.split("ê´€ë ¨ ì„¹í„°:")[-1].strip()
                if related_sectors_str.lower() != "ì—†ìŒ" and related_sectors_str:
                    # ì œì‹œëœ ì„¹í„° ëª©ë¡ê³¼ ë¹„êµí•˜ì—¬ ìœ íš¨í•œ ì„¹í„°ë§Œ í•„í„°ë§
                    potential_sectors = [sector.strip() for sector in related_sectors_str.split(',')]
                    related_sectors = [s for s in potential_sectors if s in valid_sectors_list] # ë¯¸ë¦¬ ìƒì„±í•œ ëª©ë¡ ì‚¬ìš©
                else:
                    related_sectors = [] # "ì—†ìŒ" ë˜ëŠ” ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° ë¹ˆ ë¦¬ìŠ¤íŠ¸
            else:
                 related_sectors = [] # ê´€ë ¨ ì„¹í„° íƒœê·¸ê°€ ì—†ëŠ” ê²½ìš°

            meanings[str(i + 1)] = {"explanation": explanation, "sectors": related_sectors}

        except Exception as e:
            st.error(f"ë‰´ìŠ¤ {i+1} í•´ì„¤ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
            meanings[str(i + 1)] = {"explanation": f"ì˜¤ë¥˜ ë°œìƒ: {e}", "sectors": []}
        time.sleep(0.5) # API í˜¸ì¶œ ê°„ê²©
    return meanings

# --- ì£¼ì‹ ë§¤ìˆ˜/ë§¤ë„ í•¨ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼, ë©”ì‹œì§€ ì²˜ë¦¬ ê°•í™”) ---
def buy_stock(stock_name, quantity, sector):
    if (
        sector not in st.session_state["stocks"]
        or stock_name not in st.session_state["stocks"][sector]
    ):
        st.error("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì‹ ì¢…ëª©ì…ë‹ˆë‹¤.")
        st.toast("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì‹ ì¢…ëª©ì…ë‹ˆë‹¤.", icon="âŒ")
        return

    if quantity <= 0:
        st.error("ë§¤ìˆ˜ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
        st.toast("ë§¤ìˆ˜ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.", icon="âŒ")
        return

    stock_price = st.session_state["stocks"][sector][stock_name]["current_price"]
    total_price = stock_price * quantity

    if st.session_state["portfolio"]["cash"] >= total_price:
        st.session_state["portfolio"]["cash"] -= total_price
        portfolio_stocks = st.session_state["portfolio"]["stocks"]
        if stock_name in portfolio_stocks:
            # í‰ê·  ë§¤ìˆ˜ ë‹¨ê°€ ì¬ê³„ì‚°
            current_quantity = portfolio_stocks[stock_name]["quantity"]
            current_total_purchase = portfolio_stocks[stock_name]["purchase_price"] * current_quantity
            new_quantity = current_quantity + quantity
            new_total_purchase = current_total_purchase + total_price
            portfolio_stocks[stock_name]["quantity"] = new_quantity
            portfolio_stocks[stock_name]["purchase_price"] = new_total_purchase / new_quantity if new_quantity > 0 else 0
        else:
            portfolio_stocks[stock_name] = {
                "quantity": quantity,
                "purchase_price": stock_price, # ì²« ë§¤ìˆ˜ ì‹œ ë§¤ìˆ˜ ë‹¨ê°€ëŠ” í˜„ì¬ê°€
            }
        success_msg = f"{stock_name} {quantity}ì£¼ ë§¤ìˆ˜ ì™„ë£Œ! (ì´ {total_price:,.0f}ì›)"
        st.success(success_msg)
        st.toast(success_msg, icon="âœ…")
        st.session_state['buy_confirm'] = False # í™•ì¸ ìƒíƒœ ì´ˆê¸°í™”
        save_session_data() # ìƒíƒœ ì €ì¥
    else:
        max_quantity = st.session_state["portfolio"]["cash"] // stock_price if stock_price > 0 else 0
        error_msg = f"ì”ì•¡ ë¶€ì¡±! (ìµœëŒ€ {max_quantity}ì£¼ ë§¤ìˆ˜ ê°€ëŠ¥)"
        st.error(error_msg)
        st.toast(error_msg, icon="âŒ")
        st.session_state['buy_confirm'] = False # í™•ì¸ ìƒíƒœ ì´ˆê¸°í™”

def sell_stock(stock_name, quantity):
    if stock_name not in st.session_state["portfolio"]["stocks"]:
        st.error("ë³´ìœ í•˜ê³  ìˆì§€ ì•Šì€ ì£¼ì‹ì…ë‹ˆë‹¤.")
        st.toast("ë³´ìœ í•˜ê³  ìˆì§€ ì•Šì€ ì£¼ì‹ì…ë‹ˆë‹¤.", icon="âŒ")
        return

    owned_quantity = st.session_state["portfolio"]["stocks"][stock_name]["quantity"]

    if quantity <= 0:
        st.error("ë§¤ë„ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
        st.toast("ë§¤ë„ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.", icon="âŒ")
        return

    if quantity > owned_quantity:
        st.error(f"ë§¤ë„ ê°€ëŠ¥ ìˆ˜ëŸ‰ ì´ˆê³¼! (ìµœëŒ€ {owned_quantity}ì£¼ ë§¤ë„ ê°€ëŠ¥)")
        st.toast(f"ë§¤ë„ ê°€ëŠ¥ ìˆ˜ëŸ‰ ì´ˆê³¼! (ìµœëŒ€ {owned_quantity}ì£¼ ë§¤ë„ ê°€ëŠ¥)", icon="âŒ")
        return

    # í˜„ì¬ê°€ ì°¾ê¸°
    stock_price = 0
    stock_sector = ""
    for sector, stocks_in_sector in st.session_state["stocks"].items():
        if stock_name in stocks_in_sector:
            stock_price = stocks_in_sector[stock_name]["current_price"]
            stock_sector = sector
            break

    if stock_price <= 0: # 0 ë˜ëŠ” ìŒìˆ˜ ê°€ê²© ì˜¤ë¥˜ ë°©ì§€
        st.error("ì£¼ì‹ ê°€ê²© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        st.toast("ì£¼ì‹ ê°€ê²© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", icon="âŒ")
        return

    sell_value = stock_price * quantity
    st.session_state["portfolio"]["cash"] += sell_value
    st.session_state["portfolio"]["stocks"][stock_name]["quantity"] -= quantity

    # ë³´ìœ  ìˆ˜ëŸ‰ì´ 0ì´ ë˜ë©´ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì œê±°
    if st.session_state["portfolio"]["stocks"][stock_name]["quantity"] == 0:
        del st.session_state["portfolio"]["stocks"][stock_name]

    success_msg = f"{stock_name} {quantity}ì£¼ ë§¤ë„ ì™„ë£Œ! (+{sell_value:,.0f}ì›)"
    st.success(success_msg)
    st.toast(success_msg, icon="âœ…")
    st.session_state['sell_confirm'] = False # í™•ì¸ ìƒíƒœ ì´ˆê¸°í™”
    save_session_data() # ìƒíƒœ ì €ì¥

# --- ì£¼ê°€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê¸°ì¡´ê³¼ ìœ ì‚¬, ë‰´ìŠ¤ ì˜í–¥ ë°˜ì˜) ---
def update_stock_prices():
    if not st.session_state.get("news_meanings"): # ë‰´ìŠ¤ê°€ ì•„ë‹ˆë¼ ë‰´ìŠ¤ í•´ì„¤ ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½
        # ë‰´ìŠ¤ê°€ ì—†ìœ¼ë©´ ëœë¤ ë³€ë™ë§Œ ì ìš©
        for sector in st.session_state["stocks"]:
            for stock_name in st.session_state["stocks"][sector]:
                change_rate = random.uniform(-0.03, 0.03) # ê¸°ë³¸ ë³€ë™í­
                change_rate = max(-0.1, min(0.1, change_rate)) # ìµœëŒ€ ë³€ë™í­ ì œí•œ
                current_price = st.session_state["stocks"][sector][stock_name]["current_price"]
                new_price = current_price * (1 + change_rate)
                new_price = max(1, int(new_price)) # ìµœì†Œ 1ì›
                st.session_state["stocks"][sector][stock_name]["current_price"] = new_price
                st.session_state["stocks"][sector][stock_name]["price_history"].append(new_price)
        st.info("ì£¼ê°€ê°€ ì„ì˜ë¡œ ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤.")
        st.toast("ì£¼ê°€ê°€ ì„ì˜ë¡œ ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤.", icon="ğŸ“ˆ")
        st.session_state["sector_news_impact"] = {} # ë‰´ìŠ¤ ì˜í–¥ ì—†ìŒ
        return

    # ë‰´ìŠ¤ í•´ì„¤ ê¸°ë°˜ ì„¹í„° ì˜í–¥ ê³„ì‚°
    sector_impacts = {sector: 0.0 for sector in st.session_state["stocks"]}
    news_meanings = st.session_state["news_meanings"]

    for news_index, meaning_data in news_meanings.items():
        explanation = meaning_data.get("explanation", "")
        related_sectors = meaning_data.get("sectors", [])

        # ê°„ë‹¨í•œ ê°ì„± ë¶„ì„ (ê¸ì •/ë¶€ì • í‚¤ì›Œë“œ ê¸°ë°˜)
        positive_keywords = ["ì„±ì¥", "ì¦ê°€", "í˜¸í™©", "ê°œë°œ ì„±ê³µ", "ìˆ˜ì¶œ ì¦ê°€", "ì¸ê¸°", "ê¸°ëŒ€", "ê¸ì •ì ", "ê°œì„ ", "í˜¸ì¡°", "í™•ëŒ€"]
        negative_keywords = ["ê°ì†Œ", "í•˜ë½", "ë¶€ì§„", "ì–´ë ¤ì›€", "ìœ„ê¸°", "ê²½ìŸ ì‹¬í™”", "ê·œì œ", "ë¶€ì •ì ", "ì•…í™”", "ì¶•ì†Œ", "ë‘”í™”"]

        sentiment_score = 0
        # ì„¤ëª…ì—ì„œ í‚¤ì›Œë“œ ë¹ˆë„ ê³„ì‚° (ê°„ë‹¨ ë²„ì „)
        for p_kw in positive_keywords:
            sentiment_score += explanation.count(p_kw)
        for n_kw in negative_keywords:
            sentiment_score -= explanation.count(n_kw)

        # ê´€ë ¨ ì„¹í„°ì— ì˜í–¥ ì ìš© (ì ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì˜í–¥ë ¥ ì¡°ì ˆ)
        impact_magnitude = 0.0 # ê¸°ë³¸ ì˜í–¥ë ¥ 0
        if sentiment_score > 0:
            impact_magnitude = random.uniform(0.01, 0.04) * min(sentiment_score, 3) # ì˜í–¥ë ¥ ìƒí•œì„  ì„¤ì •
        elif sentiment_score < 0:
            impact_magnitude = random.uniform(-0.04, -0.01) * min(abs(sentiment_score), 3) # ì˜í–¥ë ¥ ìƒí•œì„  ì„¤ì •

        for sector in related_sectors:
            if sector in sector_impacts:
                sector_impacts[sector] += impact_magnitude

    # ê°œë³„ ì£¼ê°€ ì—…ë°ì´íŠ¸ (ê¸°ë³¸ ë³€ë™ + ì„¹í„° ì˜í–¥)
    for sector in st.session_state["stocks"]:
        sector_impact = sector_impacts.get(sector, 0.0)
        for stock_name in st.session_state["stocks"][sector]:
            # ê¸°ë³¸ ëœë¤ ë³€ë™ (ë³€ë™í­ ì•½ê°„ ì¤„ì„)
            random_change = random.uniform(-0.02, 0.02)
            # ì´ ë³€ë™ë¥  = ê¸°ë³¸ ë³€ë™ + ì„¹í„° ì˜í–¥
            total_change_rate = random_change + sector_impact
            # ë³€ë™ë¥  ì œí•œ (ì˜ˆ: í•˜ë£¨ ìµœëŒ€ +/- 15%)
            total_change_rate = max(-0.15, min(0.15, total_change_rate))

            current_price = st.session_state["stocks"][sector][stock_name]["current_price"]
            new_price = current_price * (1 + total_change_rate)
            # ê°€ê²©ì´ 0 ì´í•˜ë¡œ ë–¨ì–´ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ 1ì›ìœ¼ë¡œ ì„¤ì •
            new_price = max(1, int(new_price))

            st.session_state["stocks"][sector][stock_name]["current_price"] = new_price
            st.session_state["stocks"][sector][stock_name]["price_history"].append(new_price)

    st.info("ë‰´ìŠ¤ ì˜í–¥ì„ ë°˜ì˜í•˜ì—¬ ì£¼ê°€ê°€ ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤.")
    st.toast("ì£¼ê°€ê°€ ë³€ë™ë˜ì—ˆìŠµë‹ˆë‹¤.", icon="ğŸ“Š")
    st.session_state["sector_news_impact"] = sector_impacts # ë””ë²„ê¹… ë˜ëŠ” ì •ë³´ ì œê³µìš©


# --- í¬íŠ¸í´ë¦¬ì˜¤ ì •ë³´ ê³„ì‚° í•¨ìˆ˜ ---
def calculate_portfolio_summary():
    portfolio = st.session_state.get("portfolio", {"cash": 0, "stocks": {}}) # ê¸°ë³¸ê°’ ì„¤ì •
    cash = portfolio.get("cash", 0)
    total_stock_value = 0
    total_purchase_value = 0

    for stock_name, stock_info in portfolio.get("stocks", {}).items():
        quantity = stock_info.get("quantity", 0)
        purchase_price = stock_info.get("purchase_price", 0)
        current_price = 0
        # í˜„ì¬ê°€ ì°¾ê¸°
        for sector, stocks_in_sector in st.session_state.get("stocks", {}).items():
            if stock_name in stocks_in_sector:
                current_price = stocks_in_sector[stock_name].get("current_price", 0)
                break
        if current_price > 0 and quantity > 0:
            total_stock_value += current_price * quantity
            total_purchase_value += purchase_price * quantity

    total_value = cash + total_stock_value
    # ì´ˆê¸° ìë³¸ê¸ˆ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ í˜„ì¬ ë ˆë²¨ ê¸°ë³¸ê°’ ì‚¬ìš©)
    initial_cash = st.session_state.get("initial_cash_set", LEVELS[st.session_state.get('selected_level', 'ì´ˆë“±')]['initial_cash'])

    total_profit_loss = total_value - initial_cash
    total_profit_rate = (total_profit_loss / initial_cash) * 100 if initial_cash > 0 else 0

    return cash, total_value, total_profit_loss, total_profit_rate, initial_cash

# --- í™”ë©´ í‘œì‹œ í•¨ìˆ˜ ---

def display_stock_prices():
    selected_level = st.session_state.get('selected_level', 'ì´ˆë“±')
    stocks_data = []
    if "stocks" not in st.session_state or not st.session_state["stocks"]:
        st.warning("ì£¼ì‹ ì •ë³´ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì•±ì„ ë‹¤ì‹œ ì‹œì‘í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.")
        return

    for sector, sector_stocks in st.session_state["stocks"].items():
        for stock_name, stock_info in sector_stocks.items():
            price_history = stock_info.get("price_history", [])
            current_price = stock_info.get("current_price", 0)
            daily_change_rate_str = " - "
            if len(price_history) >= 2:
                previous_day_price = price_history[-2]
                if previous_day_price > 0: # 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€
                    daily_change_rate = (current_price - previous_day_price) / previous_day_price * 100
                    daily_change_rate_str = f"{daily_change_rate:+.2f}%" # ë¶€í˜¸ í‘œì‹œ
                else:
                    daily_change_rate_str = "N/A"

            stocks_data.append(
                {
                    "ì¢…ëª©": stock_name,
                    "ì„¹í„°": sector,
                    "í˜„ì¬ ì£¼ê°€": f"{current_price:,.0f} ì›",
                    "ì „ì¼ ëŒ€ë¹„": daily_change_rate_str,
                    "price_history": price_history,
                    # ìˆ˜ì¤€ë³„ ì„¤ëª… ê°€ì ¸ì˜¤ê¸° (í‚¤ í˜•ì‹ ë³€ê²½ ë°˜ì˜)
                    "description": stock_info.get(f"description_{selected_level}", stock_info.get("description_ì¤‘ë“±", "ì„¤ëª… ì—†ìŒ")),
                }
            )

    if not stocks_data:
        st.info("í‘œì‹œí•  ì£¼ì‹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    stocks_df = pd.DataFrame(stocks_data)
    # ì»¬ëŸ¼ ìˆœì„œ ì§€ì • ë° í‘œì‹œ
    st.dataframe(stocks_df[["ì„¹í„°", "ì¢…ëª©", "í˜„ì¬ ì£¼ê°€", "ì „ì¼ ëŒ€ë¹„"]], hide_index=True, use_container_width=True)

    st.markdown("---")
    # ìƒì„¸ ì •ë³´ ë³´ê¸°
    stock_names_list = ["ì¢…ëª© ì„ íƒ..."] + stocks_df["ì¢…ëª©"].tolist()
    selected_stock_all_info = st.selectbox(
        "ì¢…ëª© ìƒì„¸ ì •ë³´ ë³´ê¸° (ê¸°ì—… ì •ë³´ ë° ì£¼ê°€ ê·¸ë˜í”„)", stock_names_list, key="stock_detail_select"
    )

    if selected_stock_all_info and selected_stock_all_info != "ì¢…ëª© ì„ íƒ...":
        # stocks_dfì—ì„œ ë°ì´í„° ì°¾ê¸° (ì˜¤ë¥˜ ë°©ì§€)
        selected_stock_data_list = stocks_df[stocks_df["ì¢…ëª©"] == selected_stock_all_info]
        if not selected_stock_data_list.empty:
            selected_stock_data = selected_stock_data_list.iloc[0]
            selected_stock_sector = selected_stock_data["ì„¹í„°"]

            col1_info, col2_graph = st.columns([1, 1]) # ë¹„ìœ¨ ì¡°ì •

            with col1_info:
                st.subheader(f"ğŸ¢ {selected_stock_all_info} ({selected_stock_sector}) ê¸°ì—… ì •ë³´")
                # ìˆ˜ì¤€ì— ë§ëŠ” ì„¤ëª… í‘œì‹œ
                st.info(f"{selected_stock_data['description']}")

            with col2_graph:
                st.subheader("ğŸ“ˆ ì£¼ê°€ ê·¸ë˜í”„")
                price_history = selected_stock_data["price_history"]
                if len(price_history) > 1:
                    price_history_df = pd.DataFrame({
                        "ë‚ ì§œ": range(1, len(price_history) + 1),
                        "ì£¼ê°€": price_history,
                    })
                    fig = px.line(
                        price_history_df, x="ë‚ ì§œ", y="ì£¼ê°€",
                        labels={'ë‚ ì§œ': f'ê±°ë˜ì¼ (Day)', 'ì£¼ê°€': 'ì£¼ê°€ (ì›)'}
                    )
                    fig.update_layout(margin=dict(l=0, r=0, t=30, b=0)) # ì—¬ë°± ìµœì†Œí™”
                    st.plotly_chart(fig, use_container_width=True)
                else:
                    st.warning("ì£¼ê°€ ê¸°ë¡ì´ ë¶€ì¡±í•˜ì—¬ ê·¸ë˜í”„ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        else:
            st.warning(f"'{selected_stock_all_info}' ì¢…ëª© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")


def display_portfolio_table():
    portfolio = st.session_state.get("portfolio", {"cash": 0, "stocks": {}})
    portfolio_stocks = portfolio.get("stocks", {})

    if portfolio_stocks:
        portfolio_data = []
        total_stock_value = 0
        total_purchase_value_all = 0 # ëª¨ë“  ì£¼ì‹ì˜ ì´ ë§¤ìˆ˜ ê¸ˆì•¡ í•©ê³„

        for stock_name, stock_info in portfolio_stocks.items():
            quantity = stock_info.get("quantity", 0)
            purchase_price = stock_info.get("purchase_price", 0) # í‰ê·  ë§¤ìˆ˜ ë‹¨ê°€
            current_price = 0
            stock_sector = ""
            # í˜„ì¬ê°€ ë° ì„¹í„° ì°¾ê¸°
            for sector, stocks_in_sector in st.session_state.get("stocks", {}).items():
                if stock_name in stocks_in_sector:
                    current_price = stocks_in_sector[stock_name].get("current_price", 0)
                    stock_sector = sector
                    break

            if current_price <= 0 or quantity <= 0: continue # ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° ê±´ë„ˆë›°ê¸°

            current_value = current_price * quantity # í˜„ì¬ í‰ê°€ì•¡
            purchase_value_total = purchase_price * quantity # ì´ ë§¤ìˆ˜ ê¸ˆì•¡ (ì´ ì¢…ëª©)
            profit_loss = current_value - purchase_value_total # ì†ìµ ê¸ˆì•¡
            profit_rate = (profit_loss / purchase_value_total) * 100 if purchase_value_total > 0 else 0 # ìˆ˜ìµë¥ 

            total_stock_value += current_value
            total_purchase_value_all += purchase_value_total

            portfolio_data.append({
                "ì¢…ëª©": stock_name,
                "ì„¹í„°": stock_sector,
                "ë³´ìœ  ìˆ˜ëŸ‰": quantity,
                "í‰ê·  ë§¤ìˆ˜ê°€": f"{purchase_price:,.0f} ì›", # ì»¬ëŸ¼ëª… ë³€ê²½
                "í˜„ì¬ê°€": f"{current_price:,.0f} ì›",
                "í‰ê°€ì•¡": f"{current_value:,.0f} ì›",
                "ì†ìµ": f"{profit_loss:,.0f} ì›",
                "ìˆ˜ìµë¥ ": f"{profit_rate:.2f}%",
            })

        # í˜„ê¸ˆ í–‰ ì¶”ê°€
        portfolio_data.append({
            "ì¢…ëª©": "ğŸ’° í˜„ê¸ˆ", "ì„¹í„°": "-", "ë³´ìœ  ìˆ˜ëŸ‰": "-", "í‰ê·  ë§¤ìˆ˜ê°€": "-",
            "í˜„ì¬ê°€": "-", "í‰ê°€ì•¡": f"{portfolio.get('cash', 0):,.0f} ì›", "ì†ìµ": "-", "ìˆ˜ìµë¥ ": "-",
        })

        portfolio_df = pd.DataFrame(portfolio_data)
        # ì»¬ëŸ¼ ìˆœì„œ ì§€ì • ë° í‘œì‹œ
        st.dataframe(portfolio_df[[
            "ì¢…ëª©", "ì„¹í„°", "ë³´ìœ  ìˆ˜ëŸ‰", "í‰ê·  ë§¤ìˆ˜ê°€", "í˜„ì¬ê°€", "í‰ê°€ì•¡", "ì†ìµ", "ìˆ˜ìµë¥ "
        ]], hide_index=True, use_container_width=True)

        st.markdown("---")
        # í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ ì •ë³´ í‘œì‹œ (calculate_portfolio_summary í•¨ìˆ˜ ì‚¬ìš©)
        cash, total_value, total_profit_loss, total_profit_rate, initial_cash = calculate_portfolio_summary()

        st.markdown(f"**ğŸ’° í˜„ê¸ˆ ì”ê³ :** {cash:,.0f} ì›")
        st.markdown(f"**ğŸ“Š ì´ í‰ê°€ì•¡ (ì£¼ì‹ + í˜„ê¸ˆ):** {total_value:,.0f} ì›")
        st.markdown(f"**ğŸ“ˆ ì´ ì†ìµ:** {total_profit_loss:,.0f} ì›")
        st.markdown(f"**ğŸš€ ì´ ìˆ˜ìµë¥ :** {total_profit_rate:.2f}%")
        # st.markdown(f"**ğŸ›’ ì´ ë§¤ìˆ˜ ê¸ˆì•¡ (ë³´ìœ  ì£¼ì‹):** {total_purchase_value_all:,.0f} ì›") # í•„ìš”ì‹œ ì£¼ì„ í•´ì œ
        # st.markdown(f"**ğŸŒ± ì‹œì‘ ìë³¸ê¸ˆ:** {initial_cash:,.0f} ì›") # í•„ìš”ì‹œ ì£¼ì„ í•´ì œ

    else:
        st.info("ë³´ìœ  ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤. 'ì£¼ì‹ ë§¤ìˆ˜' íƒ­ì—ì„œ ì£¼ì‹ì„ êµ¬ë§¤í•´ë³´ì„¸ìš”!")


# --- ì£¼ì‹ ìš©ì–´ ì‚¬ì „ (ìˆ˜ì¤€ë³„) ---
def display_stock_glossary():
    selected_level = st.session_state.get('selected_level', 'ì´ˆë“±')
    glossary = GLOSSARY.get(selected_level, GLOSSARY['ì´ˆë“±']) # í•´ë‹¹ ìˆ˜ì¤€ ì—†ìœ¼ë©´ ì´ˆë“± ê¸°ë³¸ê°’

    with st.sidebar.expander(f"ğŸ“š ì£¼ì‹ ìš©ì–´ ì‚¬ì „ ({LEVELS[selected_level]['name']})", expanded=False):
        for term, definition in glossary.items():
            st.markdown(f"**{term}:** {definition}")
        st.markdown("---")


# --- ë¡œê·¸ì¸ ë° ë°ì´í„° ì €ì¥/ë¡œë“œ ---
def login_sidebar():
    # ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš°
    if 'user_settings' in st.session_state and st.session_state['user_settings'] is not None:
        st.sidebar.success(f"{st.session_state['user_id']}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!")
        # ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
        if st.sidebar.button("ë¡œê·¸ì•„ì›ƒ"):
            # ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” (ë¡œê·¸ì•„ì›ƒ ì‹œ í•„ìš”í•œ ë¶€ë¶„ë§Œ)
            keys_to_reset = ["user_id", "user_settings", "portfolio", "stocks", "day_count", "daily_news", "previous_daily_news", "news_meanings", "initial_cash_set"]
            for key in keys_to_reset:
                if key in st.session_state:
                    del st.session_state[key]
            st.session_state['selected_level'] = "ì´ˆë“±" # ë ˆë²¨ ê¸°ë³¸ê°’ìœ¼ë¡œ
            st.session_state['force_reset'] = True # ì´ˆê¸°í™” í”Œë˜ê·¸ ì„¤ì •
            st.rerun() # í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        return True # ë¡œê·¸ì¸ ìƒíƒœ ë°˜í™˜

    # ë¡œê·¸ì¸ í¼
    st.sidebar.header("ë¡œê·¸ì¸")
    account = st.sidebar.text_input("ì•„ì´ë””", key="login_id")
    pw = st.sidebar.text_input("ë¹„ë°€ë²ˆí˜¸", type="password", key="login_pw")

    if st.sidebar.button("ë¡œê·¸ì¸", key="login_button"):
        if not supabase:
            st.error("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return False
        if not account or not pw:
            st.warning("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
            return False
        try:
            response = supabase.table("users").select("*").eq("account", account).eq("pw", pw).execute()
            if response.data and len(response.data) > 0:
                user_data = response.data[0]
                st.session_state["user_id"] = user_data["account"] # ì‚¬ìš©ì ID ì €ì¥
                st.session_state["selected_level"] = user_data.get("level", "ì´ˆë“±") # ì €ì¥ëœ ë ˆë²¨ ë¡œë“œ, ì—†ìœ¼ë©´ ì´ˆë“±

                if "data" in user_data and user_data["data"]:
                    try:
                        user_settings = json.loads(user_data["data"])
                        # ì €ì¥ëœ ê²Œì„ ë°ì´í„° ë³µì›
                        for key in ["stocks", "previous_daily_news", "news_meanings", "day_count", "portfolio", "daily_news", "initial_cash_set"]:
                            if key in user_settings:
                                st.session_state[key] = user_settings[key]
                        st.session_state['user_settings'] = user_settings # ë¡œë“œ ì„±ê³µ í‘œì‹œ
                        st.success("ë¡œê·¸ì¸ ì„±ê³µ! ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.")
                        # st.rerun() # ë°ì´í„° ë¡œë“œ í›„ í™”ë©´ ê°±ì‹  (ì•„ë˜ì—ì„œ ì²˜ë¦¬)
                    except json.JSONDecodeError:
                        st.error("ì €ì¥ëœ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜. ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
                        st.session_state['user_settings'] = {"new_user": True} # ì˜¤ë¥˜ ì‹œ ìƒˆ ìœ ì €ì²˜ëŸ¼
                        initialize_session_state(st.session_state["selected_level"]) # ì´ˆê¸°í™”
                    except Exception as e:
                        st.error(f"ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: {e}. ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
                        st.session_state['user_settings'] = {"new_user": True}
                        initialize_session_state(st.session_state["selected_level"])
                else:
                    st.info("ì €ì¥ëœ ê²Œì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
                    st.session_state['user_settings'] = {"new_user": True} # ìƒˆ ìœ ì € í‘œì‹œ
                    initialize_session_state(st.session_state["selected_level"]) # ì´ˆê¸°í™”

                # ë ˆë²¨ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ë° í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                st.session_state['selected_level'] = user_data.get("level", "ì´ˆë“±")
                st.rerun() # ë¡œê·¸ì¸ ì„±ê³µ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            else:
                st.error("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        except Exception as e:
            st.error(f"ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
            return False

    # íšŒì›ê°€ì… ê¸°ëŠ¥ ì œê±°ë¨

    return False # ë¡œê·¸ì¸ ì•ˆëœ ìƒíƒœ

def save_session_data():
    if supabase and 'user_id' in st.session_state and st.session_state['user_id']:
        keys_to_save = ["stocks", "previous_daily_news", "news_meanings", "day_count", "portfolio", "daily_news", "selected_level", "initial_cash_set"]
        data_to_save = {key: st.session_state[key] for key in keys_to_save if key in st.session_state}

        try:
            json_data = json.dumps(data_to_save, ensure_ascii=False, allow_nan=False, default=lambda o: '<not serializable>')
        except ValueError:
            def replace_nan_inf(obj):
                if isinstance(obj, dict):
                    return {k: replace_nan_inf(v) for k, v in obj.items()}
                elif isinstance(obj, list):
                    return [replace_nan_inf(elem) for elem in obj]
                elif isinstance(obj, float) and (obj != obj or obj == float('inf') or obj == float('-inf')):
                    return None
                return obj
            cleaned_data = replace_nan_inf(data_to_save)
            json_data = json.dumps(cleaned_data, ensure_ascii=False, allow_nan=False, default=lambda o: '<not serializable>')

        if json_data:
            try:
                supabase.table("users").update({"data": json_data}).eq("account", st.session_state["user_id"]).execute()
            except Exception as e:
                st.error(f"ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")


# --- ë©”ì¸ ì•± ë¡œì§ ---
def main():
    # ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ì²˜ë¦¬
    is_logged_in = login_sidebar()

    # ë¡œê·¸ì¸ì´ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ë©”ì¸ í™”ë©´ í‘œì‹œ ì•ˆ í•¨
    if not is_logged_in:
        st.info("ì‚¬ì´ë“œë°”ì—ì„œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.")
        # ë ˆë²¨ ì„ íƒ (ë¡œê·¸ì¸ ì•ˆí–ˆì„ ë•Œë§Œ ë³´ì´ë„ë¡) - ì´ ë¶€ë¶„ì€ ë¡œê·¸ì¸ í›„ ë ˆë²¨ ì„ íƒìœ¼ë¡œ í†µí•©ë¨
        # if 'user_settings' not in st.session_state or st.session_state['user_settings'] is None:
        #      selected_level = st.sidebar.selectbox(
        #          "í•™ìŠµ ìˆ˜ì¤€ ì„ íƒ (ë¡œê·¸ì¸ ì „)",
        #          options=list(LEVELS.keys()),
        #          format_func=lambda x: LEVELS[x]['name'],
        #          key="level_selector_pre_login",
        #          index=list(LEVELS.keys()).index(st.session_state.get('selected_level', 'ì´ˆë“±')) # ê¸°ë³¸ê°’ ë°˜ì˜
        #      )
        #      # ì„ íƒ ì‹œ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¡œê·¸ì¸ ì „ ì„ì‹œ)
        #      if st.session_state.get('selected_level') != selected_level:
        #          st.session_state['selected_level'] = selected_level
        #          # ë ˆë²¨ ë³€ê²½ ì‹œ ê²Œì„ ìƒíƒœ ì´ˆê¸°í™” í•„ìš” ì•Œë¦¼ (ì„ íƒì )
        #          st.sidebar.warning("ë ˆë²¨ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ì ìš©ë©ë‹ˆë‹¤.")

        st.stop() # ë©”ì¸ ë¡œì§ ì¤‘ë‹¨

    # --- ë¡œê·¸ì¸ í›„ ---

    # ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” (ë¡œê·¸ì¸ í›„ ë˜ëŠ” ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ)
    # user_settingsê°€ ìˆê³ , new_user í”Œë˜ê·¸ê°€ ìˆê±°ë‚˜, stocks/portfolioê°€ ë¹„ì •ìƒì¼ ë•Œ ì´ˆê¸°í™”
    should_initialize = False
    if 'user_settings' not in st.session_state or st.session_state.get('user_settings', {}).get('new_user'):
        should_initialize = True
        if 'user_settings' in st.session_state and st.session_state.get('user_settings', {}).get('new_user'):
             st.session_state['user_settings'].pop('new_user') # new_user í”Œë˜ê·¸ ì œê±°
    elif "stocks" not in st.session_state or not st.session_state["stocks"] or "portfolio" not in st.session_state:
        st.warning("ê²Œì„ ë°ì´í„° ì¼ë¶€ê°€ ìœ ì‹¤ë˜ì–´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.")
        should_initialize = True

    if should_initialize:
        initialize_session_state(st.session_state['selected_level'])


    # ì‚¬ì´ë“œë°” ìƒë‹¨ì— ë ˆë²¨ ì„ íƒ (ë¡œê·¸ì¸ í›„)
    current_level_index = list(LEVELS.keys()).index(st.session_state.get('selected_level', 'ì´ˆë“±'))
    selected_level = st.sidebar.selectbox(
        "í•™ìŠµ ìˆ˜ì¤€",
        options=list(LEVELS.keys()),
        format_func=lambda x: LEVELS[x]['name'],
        key="level_selector_post_login",
        index=current_level_index # í˜„ì¬ ë ˆë²¨ ë°˜ì˜
    )

    # ë ˆë²¨ ë³€ê²½ ê°ì§€ ë° ì²˜ë¦¬
    if st.session_state.get('selected_level') != selected_level:
        st.session_state['selected_level'] = selected_level
        st.sidebar.warning("í•™ìŠµ ìˆ˜ì¤€ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìš©ì–´ ì‚¬ì „ê³¼ ë‰´ìŠ¤/í•´ì„¤ì˜ ë‚œì´ë„ê°€ ì¡°ì •ë©ë‹ˆë‹¤.")
        # ë ˆë²¨ ë³€ê²½ ì‹œ ê²Œì„ ë¦¬ì…‹ ì—¬ë¶€ í™•ì¸ (ì„ íƒì )
        if st.sidebar.button("âš ï¸ ë ˆë²¨ ë³€ê²½ ì ìš© (ê²Œì„ ì´ˆê¸°í™”)", key="level_reset_confirm"):
             st.session_state['force_reset'] = True # ì´ˆê¸°í™” í”Œë˜ê·¸
             initialize_session_state(selected_level) # ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
             save_session_data() # ë³€ê²½ëœ ë ˆë²¨ ë° ì´ˆê¸°í™”ëœ ë°ì´í„° ì €ì¥
             st.success("ë ˆë²¨ì´ ë³€ê²½ë˜ì—ˆê³  ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")
             st.rerun()
        else:
            st.sidebar.info("ê²Œì„ ì´ˆê¸°í™”ë¥¼ ì›í•˜ì‹œë©´ ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. ëˆ„ë¥´ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ê²Œì„ ìƒíƒœëŠ” ìœ ì§€ë©ë‹ˆë‹¤.")
            save_session_data() # ë³€ê²½ëœ ë ˆë²¨ë§Œ ì €ì¥
            st.rerun() # í™”ë©´ ì¦‰ì‹œ ë°˜ì˜ (ë ˆë²¨ í‘œì‹œ ë“±)


    # --- ë©”ì¸ í™”ë©´ êµ¬ì„± ---
    st.title(f"ğŸ“ˆ {LEVELS[selected_level]['name']} ëª¨ì˜ ì£¼ì‹ íˆ¬ì")

    # ì‚¬ì´ë“œë°” ì •ë³´ í‘œì‹œ
    with st.sidebar:
        st.markdown("---")
        st.markdown(f"### Day {st.session_state.get('day_count', 1)}") # ê¸°ë³¸ê°’ 1
        st.markdown("---")
        # í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½
        cash, total_value, total_profit_loss, total_profit_rate, _ = calculate_portfolio_summary()
        st.metric(label="ğŸ’° í˜„ê¸ˆ ì”ê³ ", value=f"{cash:,.0f} ì›")
        st.metric(label="ğŸ“Š ì´ í‰ê°€ ê¸ˆì•¡", value=f"{total_value:,.0f} ì›", delta=f"{total_profit_loss:,.0f} ì›")
        st.metric(label="ğŸš€ ì´ ìˆ˜ìµë¥ ", value=f"{total_profit_rate:.2f}%")
        st.markdown("---")

        # í•˜ë£¨ ì§€ë‚˜ê¸° ë²„íŠ¼
        if st.button("â˜€ï¸ í•˜ë£¨ ì§€ë‚˜ê¸°", use_container_width=True, key="day_pass_button"):
            if st.session_state.get("daily_news"):
                current_day = st.session_state.get('day_count', 1)
                with st.spinner(f"Day {current_day} ë§ˆê° ë° Day {current_day + 1} ì¤€ë¹„ ì¤‘..."):
                    # 1. í˜„ì¬ ë‰´ìŠ¤ ì €ì¥ (ì´ì „ ë‰´ìŠ¤ë¡œ)
                    st.session_state["previous_daily_news"] = st.session_state["daily_news"]
                    # 2. ì´ì „ ë‰´ìŠ¤ í•´ì„¤ ìƒì„±
                    meanings = explain_daily_news_meanings(st.session_state["previous_daily_news"])
                    if meanings:
                        st.session_state["news_meanings"] = meanings
                    else:
                        st.session_state["news_meanings"] = {} # ì‹¤íŒ¨ ì‹œ ì´ˆê¸°í™”
                    # 3. ì£¼ê°€ ì—…ë°ì´íŠ¸ (ë‰´ìŠ¤ í•´ì„¤ ê¸°ë°˜)
                    update_stock_prices()
                    # 4. ë‹¤ìŒ ë‚  ë‰´ìŠ¤ ìƒì„±
                    st.session_state["daily_news"] = generate_news()
                    # 5. ë‚ ì§œ ì¦ê°€
                    st.session_state["day_count"] = current_day + 1
                    # 6. ìƒíƒœ ì €ì¥
                    save_session_data()
                st.success(f"Day {st.session_state['day_count']} ì‹œì‘! ì£¼ê°€ê°€ ë³€ë™ë˜ì—ˆê³  ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
                st.toast("ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!", icon="ğŸŒ…")
                st.rerun() # ë³€ê²½ì‚¬í•­ ë°˜ì˜ ìœ„í•´ ìƒˆë¡œê³ ì¹¨
            else:
                st.warning("ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.")
        st.markdown("---")

        # ìš©ì–´ ì‚¬ì „ í‘œì‹œ
        display_stock_glossary()

        # ì•± ê°€ì´ë“œ í‘œì‹œ
        with st.sidebar.expander("ğŸš€ ì•± ì‚¬ìš© ê°€ì´ë“œ", expanded=False):
            # (ê¸°ì¡´ ê°€ì´ë“œ ë‚´ìš© ìœ ì§€)
            st.markdown(
                """
        **1ë‹¨ê³„: ë‰´ìŠ¤ ìƒì„±í•˜ê¸°**
        - ì™¼ìª½ 'ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤' ì˜ì—­ì—ì„œ 'ë‰´ìŠ¤ ìƒì„±' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
        - AIê°€ í˜„ì¬ ì„¤ì •ëœ í•™ìŠµ ìˆ˜ì¤€ì— ë§ì¶° ì£¼ì‹ ì‹œì¥ ë‰´ìŠ¤ë¥¼ 5ê°œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

        **2ë‹¨ê³„: ë‰´ìŠ¤ ì½ê³  ì˜ˆì¸¡í•˜ê¸°**
        - ìƒì„±ëœ ë‰´ìŠ¤ë¥¼ ê¼¼ê¼¼íˆ ì½ì–´ë³´ì„¸ìš”.
        - 'ì–´ë–¤ ì¢…ë¥˜ì˜ íšŒì‚¬ê°€ ì´ë“ì„ ë³¼ê¹Œ?' ë˜ëŠ” 'ì–´ë–¤ íšŒì‚¬ê°€ ì–´ë ¤ìš¸ê¹Œ?' ìƒê°í•´ë³´ì„¸ìš”.
        - ë‰´ìŠ¤ë¥¼ í†µí•´ ê²½ì œ íë¦„ì„ ì½ëŠ” ì—°ìŠµì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        **3ë‹¨ê³„: ì£¼ê°€ ë° ê¸°ì—… ì •ë³´ í™•ì¸í•˜ê¸°**
        - ë©”ì¸ í™”ë©´ì˜ 'ğŸ“ˆ í˜„ì¬ ì£¼ê°€' íƒ­ì—ì„œ ì£¼ì‹ë“¤ì˜ í˜„ì¬ ê°€ê²©ê³¼ ë³€ë™ë¥ ì„ í™•ì¸í•˜ì„¸ìš”.
        - ê´€ì‹¬ ìˆëŠ” ì¢…ëª©ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ê¸°ì—…ì— ëŒ€í•œ ì„¤ëª…(ìˆ˜ì¤€ë³„)ê³¼ ì£¼ê°€ ê·¸ë˜í”„ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        **4ë‹¨ê³„: ì£¼ì‹ ë§¤ìˆ˜í•˜ê¸°**
        - 'ğŸ’° ì£¼ì‹ ë§¤ìˆ˜' íƒ­ì—ì„œ ì›í•˜ëŠ” ì¢…ëª©ê³¼ ìˆ˜ëŸ‰ì„ ì„ íƒ í›„ 'ì£¼ì‹ ë§¤ìˆ˜' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
        - ì •ë§ ë§¤ìˆ˜í• ì§€ í™•ì¸ ì°½ì´ ëœ¹ë‹ˆë‹¤. 'ë§¤ìˆ˜ í™•ì¸'ì„ ëˆ„ë¥´ë©´ ê±°ë˜ê°€ ì™„ë£Œë©ë‹ˆë‹¤.
        - **íŒ:** ë‰´ìŠ¤ë¥¼ ë³´ê³  ìœ ë§í•˜ë‹¤ê³  ìƒê°ë˜ëŠ” ì„¹í„°ì˜ ì£¼ì‹ì„ ê³¨ë¼ë³´ì„¸ìš”!

        **5ë‹¨ê³„: ë‚´ í¬íŠ¸í´ë¦¬ì˜¤ í™•ì¸í•˜ê¸°**
        - 'ğŸ“Š ë‚´ í¬íŠ¸í´ë¦¬ì˜¤' íƒ­ì—ì„œ ë‚´ê°€ ê°€ì§„ ì£¼ì‹ê³¼ í˜„ê¸ˆ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”.
        - ê° ì£¼ì‹ì˜ ìˆ˜ìµë¥ ê³¼ ì´ ìì‚° ë³€í™”ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        **6ë‹¨ê³„: ì£¼ì‹ ë§¤ë„í•˜ê¸°**
        - 'ğŸ“‰ ì£¼ì‹ ë§¤ë„' íƒ­ì—ì„œ íŒ”ê³  ì‹¶ì€ ì£¼ì‹ê³¼ ìˆ˜ëŸ‰ì„ ì„ íƒ í›„ 'ì£¼ì‹ ë§¤ë„' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
        - í™•ì¸ ì°½ì—ì„œ 'ë§¤ë„ í™•ì¸'ì„ ëˆ„ë¥´ë©´ ì£¼ì‹ì„ íŒ”ê³  í˜„ê¸ˆì„ ì–»ìŠµë‹ˆë‹¤.
        - **íŒ:** ì£¼ê°€ê°€ ì¶©ë¶„íˆ ì˜¬ëë‹¤ê³  ìƒê°ë  ë•Œ íŒ”ì•„ ì´ìµì„ ì‹¤í˜„í•´ë³´ì„¸ìš”!

        **7ë‹¨ê³„: í•˜ë£¨ ì§€ë‚˜ê¸° & ë‰´ìŠ¤ í•´ì„¤ ë³´ê¸°**
        - ì‚¬ì´ë“œë°”ì˜ 'â˜€ï¸ í•˜ë£¨ ì§€ë‚˜ê¸°' ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì‹œê°„ì´ íë¦…ë‹ˆë‹¤.
        - ì£¼ê°€ê°€ ë³€ë™ë˜ê³ , ìƒˆë¡œìš´ ë‰´ìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.
        - 'ğŸ“° ì–´ì œ ë‰´ìŠ¤ í•´ì„¤' íƒ­ì—ì„œ AIê°€ ë¶„ì„í•œ ì´ì „ ë‚  ë‰´ìŠ¤ì˜ ì˜ë¯¸ì™€ ê´€ë ¨ ì„¹í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. (ìˆ˜ì¤€ë³„ í•´ì„¤ ì œê³µ)

        **ê¾¸ì¤€íˆ í•™ìŠµí•˜ê¸°! ğŸŒ±**
        - ë§¤ì¼ ë‰´ìŠ¤ë¥¼ ì½ê³ , íˆ¬ìë¥¼ ê²°ì •í•˜ê³ , ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” ê³¼ì •ì„ ë°˜ë³µí•˜ë©° ê²½ì œì™€ íˆ¬ìì— ëŒ€í•œ ê°ê°ì„ í‚¤ì›Œë³´ì„¸ìš”!
        - ëª¨ë¥´ëŠ” ìš©ì–´ëŠ” 'ğŸ“š ì£¼ì‹ ìš©ì–´ ì‚¬ì „'ì„ ì°¸ê³ í•˜ì„¸ìš”.
        """
            )

    # --- ë©”ì¸ ì˜ì—­ ë ˆì´ì•„ì›ƒ ---
    col_news, col_main_ui = st.columns([1, 2]) # ë‰´ìŠ¤ ì˜ì—­ê³¼ ë©”ì¸ UI ì˜ì—­ ë¶„í• 

    with col_news:
        st.header(f"ğŸ“° Day {st.session_state.get('day_count', 1)} ë‰´ìŠ¤")
        # ë‰´ìŠ¤ ìƒì„± ë²„íŠ¼
        if st.button("ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ ìƒì„±í•˜ê¸°", use_container_width=True, key="news_gen_button", help="AIê°€ ì˜¤ëŠ˜ì˜ ê²½ì œ ë‰´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."):
            with st.spinner(f"Day {st.session_state.get('day_count', 1)} ë‰´ìŠ¤ ìƒì„± ì¤‘... (ìˆ˜ì¤€: {LEVELS[selected_level]['name']})"):
                st.session_state["daily_news"] = generate_news()
                st.session_state["news_meanings"] = {} # ìƒˆ ë‰´ìŠ¤ ìƒì„± ì‹œ ì´ì „ í•´ì„¤ ì´ˆê¸°í™”
                save_session_data() # ë‰´ìŠ¤ ìƒì„± í›„ ì €ì¥
            st.rerun() # ë‰´ìŠ¤ í‘œì‹œ ìœ„í•´ ìƒˆë¡œê³ ì¹¨

        # ìƒì„±ëœ ë‰´ìŠ¤ í‘œì‹œ
        if st.session_state.get("daily_news"):
            st.markdown("---")
            st.subheader("ì˜¤ëŠ˜ì˜ ì£¼ìš” ë‰´ìŠ¤")
            for i, news in enumerate(st.session_state["daily_news"]):
                with st.expander(f"**ë‰´ìŠ¤ {i+1}**", expanded=(i==0)): # ì²« ë²ˆì§¸ ë‰´ìŠ¤ë§Œ í¼ì¹˜ê¸°
                    st.write(news)
            st.markdown("---")
            st.info("ğŸ’¡ ë‰´ìŠ¤ë¥¼ ì½ê³  ì–´ë–¤ ì„¹í„°/ê¸°ì—…ì— ì˜í–¥ì´ ìˆì„ì§€ ì˜ˆì¸¡í•´ë³´ì„¸ìš”! 'í•˜ë£¨ ì§€ë‚˜ê¸°' í›„ 'ì–´ì œ ë‰´ìŠ¤ í•´ì„¤' íƒ­ì—ì„œ AI ë¶„ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        else:
            st.info("ğŸ‘† 'ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ ìƒì„±í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‰´ìŠ¤ë¥¼ ë°›ì•„ë³´ì„¸ìš”.")


    with col_main_ui:
        # ë©”ì¸ íƒ­ êµ¬ì„±
        tab_titles = ['ğŸ“ˆ í˜„ì¬ ì£¼ê°€', 'ğŸ“Š ë‚´ í¬íŠ¸í´ë¦¬ì˜¤', 'ğŸ’° ì£¼ì‹ ë§¤ìˆ˜', 'ğŸ“‰ ì£¼ì‹ ë§¤ë„', 'ğŸ“° ì–´ì œ ë‰´ìŠ¤ í•´ì„¤']
        tabs = st.tabs(tab_titles)

        with tabs[0]: # í˜„ì¬ ì£¼ê°€ íƒ­
            st.subheader("ğŸ“ˆ í˜„ì¬ ì£¼ê°€ ë° ê¸°ì—… ì •ë³´")
            st.markdown("ì‹¤ì‹œê°„ ì£¼ê°€ ë³€ë™ê³¼ ê¸°ì—… ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì¢…ëª© ì„ íƒ ì‹œ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.")
            display_stock_prices()

        with tabs[1]: # ë‚´ í¬íŠ¸í´ë¦¬ì˜¤ íƒ­
            st.subheader("ğŸ“Š ë‚´ í¬íŠ¸í´ë¦¬ì˜¤")
            st.markdown("ë³´ìœ  ì¤‘ì¸ ì£¼ì‹ê³¼ ìì‚° í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.")
            display_portfolio_table()

        with tabs[2]: # ì£¼ì‹ ë§¤ìˆ˜ íƒ­
            st.subheader("ğŸ’° ì£¼ì‹ ë§¤ìˆ˜")
            st.markdown("íˆ¬ìí•˜ê³  ì‹¶ì€ ì£¼ì‹ì„ ë§¤ìˆ˜í•´ë³´ì„¸ìš”.")

            # ì„¹í„° ì„ íƒ -> ì¢…ëª© ì„ íƒ ì—°ë™
            sector_names = ["ì„¹í„° ì„ íƒ..."] + list(st.session_state.get("stocks", {}).keys())
            selected_sector_buy = st.selectbox("1. ë§¤ìˆ˜í•  ì„¹í„° ì„ íƒ:", sector_names, key="buy_sector")

            if selected_sector_buy != "ì„¹í„° ì„ íƒ...":
                stock_names_in_sector = ["ì¢…ëª© ì„ íƒ..."] + list(st.session_state.get("stocks", {}).get(selected_sector_buy, {}).keys())
                selected_stock_buy = st.selectbox("2. ë§¤ìˆ˜í•  ì¢…ëª© ì„ íƒ:", stock_names_in_sector, key="buy_stock")

                if selected_stock_buy != "ì¢…ëª© ì„ íƒ...":
                    stock_info_buy = st.session_state.get("stocks", {}).get(selected_sector_buy, {}).get(selected_stock_buy)
                    if stock_info_buy: # ì£¼ì‹ ì •ë³´ ìˆëŠ”ì§€ í™•ì¸
                        stock_price_buy = stock_info_buy.get("current_price", 0)
                        # ìˆ˜ì¤€ë³„ ì„¤ëª… ê°€ì ¸ì˜¤ê¸° (í‚¤ í˜•ì‹ ë³€ê²½ ë°˜ì˜)
                        description_key = f"description_{selected_level}"
                        stock_description = stock_info_buy.get(description_key, stock_info_buy.get("description_ì¤‘ë“±","ì„¤ëª… ì—†ìŒ"))

                        st.info(f"**{selected_stock_buy}** í˜„ì¬ ì£¼ê°€: **{stock_price_buy:,.0f}ì›**")
                        st.caption(f"ê¸°ì—… ì •ë³´: {stock_description}")

                        # ë§¤ìˆ˜ ê°€ëŠ¥ ìˆ˜ëŸ‰ ê³„ì‚° ë° í‘œì‹œ
                        available_cash = st.session_state.get("portfolio", {}).get("cash", 0)
                        max_buy_quantity = available_cash // stock_price_buy if stock_price_buy > 0 else 0
                        st.caption(f"í˜„ê¸ˆ ì”ê³ : {available_cash:,.0f}ì› (ìµœëŒ€ {max_buy_quantity}ì£¼ ë§¤ìˆ˜ ê°€ëŠ¥)")

                        quantity_buy = st.number_input(
                            f"3. ë§¤ìˆ˜ ìˆ˜ëŸ‰ ì…ë ¥ (ìµœëŒ€ {max_buy_quantity}ì£¼):",
                            min_value=1,
                            max_value=max(1, max_buy_quantity), # 0ì£¼ ë°©ì§€, ìµœëŒ€ê°’ 1 ì´ìƒ
                            value=1,
                            step=1,
                            key="buy_quantity",
                            disabled=(max_buy_quantity == 0) # ì”ì•¡ ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
                        )

                        total_buy_price = stock_price_buy * quantity_buy
                        st.markdown(f"**ì˜ˆìƒ ë§¤ìˆ˜ ê¸ˆì•¡:** {total_buy_price:,.0f} ì›")

                        # ë§¤ìˆ˜ í™•ì¸ ì ˆì°¨
                        if not st.session_state.get('buy_confirm', False):
                            if st.button("ì£¼ì‹ ë§¤ìˆ˜", use_container_width=True, key='buy_button_confirm', disabled=(max_buy_quantity == 0 or quantity_buy <= 0)):
                                if quantity_buy > max_buy_quantity:
                                    st.error(f"ë§¤ìˆ˜ ê°€ëŠ¥ ìˆ˜ëŸ‰ ì´ˆê³¼! (ìµœëŒ€ {max_buy_quantity}ì£¼)")
                                elif quantity_buy <= 0:
                                    st.error("ë§¤ìˆ˜ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
                                else:
                                    st.session_state['buy_confirm'] = True
                                    st.rerun() # í™•ì¸ UI í‘œì‹œ ìœ„í•´ ìƒˆë¡œê³ ì¹¨
                        else:
                            st.warning(f"**{selected_stock_buy} {quantity_buy}ì£¼**ë¥¼ **{total_buy_price:,.0f}ì›**ì— ë§¤ìˆ˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
                            col_confirm, col_cancel = st.columns([1, 1])
                            with col_confirm:
                                if st.button("âœ… ë„¤, ë§¤ìˆ˜í•©ë‹ˆë‹¤", use_container_width=True, key='buy_confirm_button'):
                                    buy_stock(selected_stock_buy, quantity_buy, selected_sector_buy)
                                    st.rerun() # í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸ ë°˜ì˜
                            with col_cancel:
                                if st.button("âŒ ì•„ë‹ˆìš”, ì·¨ì†Œí•©ë‹ˆë‹¤", use_container_width=True, key='buy_cancel_button'):
                                    st.session_state['buy_confirm'] = False
                                    st.info("ë§¤ìˆ˜ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.")
                                    st.rerun() # í™•ì¸ UI ìˆ¨ê¸°ê¸°
                    else:
                        st.warning("ì„ íƒí•œ ì¢…ëª© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            else:
                st.info("ë¨¼ì € ë§¤ìˆ˜í•  ì„¹í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")


        with tabs[3]: # ì£¼ì‹ ë§¤ë„ íƒ­
            st.subheader("ğŸ“‰ ì£¼ì‹ ë§¤ë„")
            st.markdown("ë³´ìœ  ì¤‘ì¸ ì£¼ì‹ì„ íŒë§¤í•˜ì—¬ í˜„ê¸ˆí™”í•˜ì„¸ìš”.")

            portfolio_stocks = st.session_state.get("portfolio", {}).get("stocks", {})
            if portfolio_stocks:
                owned_stock_names = ["ì¢…ëª© ì„ íƒ..."] + list(portfolio_stocks.keys())
                selected_stock_sell = st.selectbox("1. ë§¤ë„í•  ì¢…ëª© ì„ íƒ:", owned_stock_names, key="sell_stock")

                if selected_stock_sell != "ì¢…ëª© ì„ íƒ...":
                    stock_info_sell = portfolio_stocks.get(selected_stock_sell)
                    if stock_info_sell: # ë³´ìœ  ì •ë³´ ìˆëŠ”ì§€ í™•ì¸
                        owned_quantity = stock_info_sell.get("quantity", 0)
                        purchase_price_avg = stock_info_sell.get("purchase_price", 0)

                        # í˜„ì¬ê°€ ì°¾ê¸°
                        current_price_sell = 0
                        for sector, stocks_in_sector in st.session_state.get("stocks", {}).items():
                            if selected_stock_sell in stocks_in_sector:
                                current_price_sell = stocks_in_sector[selected_stock_sell].get("current_price", 0)
                                break

                        st.info(f"**{selected_stock_sell}** ë³´ìœ  ìˆ˜ëŸ‰: **{owned_quantity}ì£¼**")
                        st.caption(f"í‰ê·  ë§¤ìˆ˜ê°€: {purchase_price_avg:,.0f}ì› / í˜„ì¬ê°€: {current_price_sell:,.0f}ì›")

                        quantity_sell = st.number_input(
                            f"2. ë§¤ë„ ìˆ˜ëŸ‰ ì…ë ¥ (ìµœëŒ€ {owned_quantity}ì£¼):",
                            min_value=1,
                            max_value=owned_quantity,
                            value=1,
                            step=1,
                            key="sell_quantity",
                            disabled=(owned_quantity == 0) # ë³´ìœ ëŸ‰ ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
                        )

                        total_sell_price = current_price_sell * quantity_sell
                        st.markdown(f"**ì˜ˆìƒ ë§¤ë„ ê¸ˆì•¡:** {total_sell_price:,.0f} ì›")

                        # ë§¤ë„ í™•ì¸ ì ˆì°¨
                        if not st.session_state.get('sell_confirm', False):
                            if st.button("ì£¼ì‹ ë§¤ë„", use_container_width=True, key='sell_button_confirm', disabled=(owned_quantity == 0 or quantity_sell <= 0)):
                                if quantity_sell > owned_quantity:
                                    st.error(f"ë§¤ë„ ê°€ëŠ¥ ìˆ˜ëŸ‰ ì´ˆê³¼! (ìµœëŒ€ {owned_quantity}ì£¼)")
                                elif quantity_sell <= 0:
                                    st.error("ë§¤ë„ ìˆ˜ëŸ‰ì€ 1ì£¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
                                else:
                                    st.session_state['sell_confirm'] = True
                                    st.rerun()
                        else:
                            st.warning(f"**{selected_stock_sell} {quantity_sell}ì£¼**ë¥¼ **{total_sell_price:,.0f}ì›**ì— ë§¤ë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
                            col_confirm, col_cancel = st.columns([1, 1])
                            with col_confirm:
                                if st.button("âœ… ë„¤, ë§¤ë„í•©ë‹ˆë‹¤", use_container_width=True, key='sell_confirm_button'):
                                    sell_stock(selected_stock_sell, quantity_sell)
                                    st.rerun()
                            with col_cancel:
                                if st.button("âŒ ì•„ë‹ˆìš”, ì·¨ì†Œí•©ë‹ˆë‹¤", use_container_width=True, key='sell_cancel_button'):
                                    st.session_state['sell_confirm'] = False
                                    st.info("ë§¤ë„ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.")
                                    st.rerun()
                    else:
                        st.warning("ì„ íƒí•œ ë³´ìœ  ì£¼ì‹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            else:
                st.info("ë§¤ë„í•  ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì£¼ì‹ì„ ë§¤ìˆ˜í•˜ì„¸ìš”.")

        with tabs[4]: # ì–´ì œ ë‰´ìŠ¤ í•´ì„¤ íƒ­
            st.subheader(f"ğŸ“° Day {st.session_state.get('day_count', 1) - 1} ë‰´ìŠ¤ í•´ì„¤")
            st.markdown(f"AIê°€ ë¶„ì„í•œ ì–´ì œ ë‰´ìŠ¤ì˜ ì˜ë¯¸ì™€ ê´€ë ¨ ì„¹í„°ì…ë‹ˆë‹¤. ({LEVELS[selected_level]['name']} ìˆ˜ì¤€)")

            previous_daily_news = st.session_state.get("previous_daily_news")
            news_meanings = st.session_state.get("news_meanings")

            if previous_daily_news and news_meanings:
                if len(previous_daily_news) == len(news_meanings):
                    for i in range(len(previous_daily_news)):
                        news_index_str = str(i + 1)
                        meaning_data = news_meanings.get(news_index_str)
                        if meaning_data: # í•´ì„¤ ë°ì´í„° ìˆëŠ”ì§€ í™•ì¸
                            with st.expander(f"**ë‰´ìŠ¤ {news_index_str}**", expanded=False):
                                st.markdown("**ì–´ì œ ë‰´ìŠ¤ ì›ë¬¸:**")
                                st.write(previous_daily_news[i])
                                st.markdown("---")
                                st.markdown("**AI í•´ì„¤:**")
                                explanation = meaning_data.get("explanation", "í•´ì„¤ ì—†ìŒ")
                                sectors = meaning_data.get("sectors", [])
                                st.info(explanation)
                                if sectors:
                                    st.markdown("**ê´€ë ¨ ì„¹í„°:**")
                                    st.success(f"{', '.join(sectors)}")
                                else:
                                    st.markdown("**ê´€ë ¨ ì„¹í„°:** ì—†ìŒ")
                        else:
                            st.warning(f"ë‰´ìŠ¤ {news_index_str}ì— ëŒ€í•œ í•´ì„¤ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                else:
                    st.warning("ë‰´ìŠ¤ ê°œìˆ˜ì™€ í•´ì„¤ ê°œìˆ˜ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë°ì´í„° ì˜¤ë¥˜ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.")

            elif st.session_state.get('day_count', 1) == 1:
                 st.info("ì²« ë‚ ì—ëŠ” ì´ì „ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. 'í•˜ë£¨ ì§€ë‚˜ê¸°'ë¥¼ ëˆŒëŸ¬ ë‹¤ìŒ ë‚ ë¡œ ì´ë™í•˜ì„¸ìš”.")
            else:
                st.info("ì•„ì§ ì–´ì œ ë‰´ìŠ¤ì— ëŒ€í•œ í•´ì„¤ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. 'í•˜ë£¨ ì§€ë‚˜ê¸°'ë¥¼ ì§„í–‰í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")


if __name__ == "__main__":
    # ì•± ì‹œì‘ ì‹œ ì´ˆê¸° ë ˆë²¨ ì„¤ì • (ì„¸ì…˜ ìƒíƒœì— ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
    if 'selected_level' not in st.session_state:
        st.session_state['selected_level'] = "ì´ˆë“±"
    main()